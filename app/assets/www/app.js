var s_logo="Resources/logo.png",s_gameOver="Resources/gameOver.png",s_menuTitle="Resources/menuTitle.png",s_flare="Resources/flare.jpg",s_explosion="Resources/explosion.png",s_explode1="Resources/explode1.jpg",s_explode2="Resources/explode2.jpg",s_explode3="Resources/explode3.jpg",s_background="Resources/background.png",s_background1="Resources/background1.png",s_background2="Resources/background2.png",s_background3="Resources/background3.png",s_start_menu="Resources/start_menu.png",s_hook="Resources/hook.png",
s_hook_long="Resources/hook_long.png",s_big_rock="Resources/big_rock.png",s_small_rock="Resources/small_rock.png",s_big_gold="Resources/big_gold.png",s_small_gold="Resources/small_gold.png",s_pig="Resources/pig.png",s_big_diamond="Resources/big_diamond.png",s_small_diamond="Resources/small_diamond.png",s_bone="Resources/bone.png",s_bomb="Resources/bomb.png",s_milk="Resources/milk.png",s_clock="Resources/clock.png",s_money_tree="Resources/money_tree.png",s_rich="Resources/rich.png",s_accept="Resources/accept.png",
s_bg="Resources/welcome.png",s_gamebg="Resources/gamebg.png",s_array1="Resources/array1.png",s_array2="Resources/array2.png",s_array3="Resources/array3.png",s_array1_big="Resources/array1_big.png",s_array2_big="Resources/array2_big.png",s_array3_big="Resources/array3_big.png",s_animals="Resources/animals.png",s_dog="Resources/dog.png",s_cow="Resources/cow.png",s_sheep="Resources/sheep.png",s_boy="Resources/boy.png",s_backbig="Resources/backbig.png",s_back="Resources/back.png",s_about="Resources/about.png",
s_failedbg="Resources/failedbg.png",s_replay="Resources/replay.png",s_replaybig="Resources/replaybig.png",s_exit="Resources/exit.png",s_exitbig="Resources/exitbig.png",s_board="Resources/board.png",s_mission1="Resources/mission1.png",s_mission2="Resources/mission2.png",s_mission3="Resources/mission3.png",s_mission4="Resources/mission4.png",s_mission_bg="Resources/missionbg.png",s_middle_gold="Resources/middle_gold.png",s_middle_gold="Resources/middle_gold.png",s_mission_ruler="Resources/missionruler.png",
s_shopbg="Resources/shopbg.png",s_nextgame="Resources/nextgame.png",s_nextgamebig="Resources/nextgamebig.png",s_milk1="Resources/milk1.png",s_milk2="Resources/milk2.png",s_stonebook="Resources/stonebook.png",s_bonebook="Resources/bonebook.png",s_aim="Resources/aim.png",s_burst="Resources/burst.png",s_blank="Resources/blank.png",s_bat="Resources/bat.png",s_bgdouble="Resources/backgrounddouble.png",s_singleplayer="Resources/singleplayer.png",s_doubleplayer="Resources/doubleplayer.png",s_singleplayerbig=
"Resources/singleplayerbig.png",s_doubleplayerbig="Resources/doubleplayerbig.png",s_bgMusic="Resources/Music/bgMusic",s_mainMainMusic="Resources/Music/mainMainMusic",s_buttonEffect="Resources/Music/buttonEffet",s_explodeEffect="Resources/Music/explodeEffect",s_fireEffect="Resources/Music/fireEffect",s_shipDestroyEffect="Resources/Music/shipDestroyEffect",s_explosion_plist="Resources/explosion.plist",s_bitmapFontTest3_fnt="Resources/fonts/bitmapFontTest3.fnt",s_bitmapFontTest3_png="Resources/fonts/bitmapFontTest3.png",
s_bitmapFontTest5_fnt="Resources/fonts/bitmapFontTest5.fnt",s_bitmapFontTest5_png="Resources/fonts/bitmapFontTest5.png",s_futura_fnt="Resources/fonts/futura-48.fnt",s_futura_png="Resources/fonts/futura-48.png",s_bitMapChinese="Resources/fonts/bitmapFontChinese.fnt",s_bitMapChinesepng="Resources/fonts/bitmapFontChinese.png",g_ressources=[{type:"image",src:s_bg},{type:"image",src:s_boy},{type:"image",src:s_sheep},{type:"image",src:s_animals},{type:"image",src:s_cow},{type:"image",src:s_about},{type:"image",
src:s_dog},{type:"image",src:s_back},{type:"image",src:s_backbig},{type:"image",src:s_failedbg},{type:"image",src:s_replaybig},{type:"image",src:s_replay},{type:"image",src:s_board},{type:"image",src:s_logo},{type:"image",src:s_gameOver},{type:"image",src:s_menuTitle},{type:"image",src:s_flare},{type:"image",src:s_explosion},{type:"image",src:s_explode1},{type:"image",src:s_explode2},{type:"image",src:s_explode3},{type:"image",src:s_blank},{type:"image",src:s_milk1},{type:"image",src:s_milk2},{type:"image",
src:s_bonebook},{type:"image",src:s_stonebook},{type:"image",src:s_aim},{type:"image",src:s_bat},{type:"image",src:s_background},{type:"image",src:s_background1},{type:"image",src:s_background2},{type:"image",src:s_background3},{type:"image",src:s_start_menu},{type:"image",src:s_hook},{type:"image",src:s_hook_long},{type:"image",src:s_big_rock},{type:"image",src:s_small_rock},{type:"image",src:s_big_gold},{type:"image",src:s_middle_gold},{type:"image",src:s_small_gold},{type:"image",src:s_pig},{type:"image",
src:s_big_diamond},{type:"image",src:s_small_diamond},{type:"image",src:s_bone},{type:"image",src:s_bomb},{type:"image",src:s_milk},{type:"image",src:s_clock},{type:"image",src:s_money_tree},{type:"image",src:s_rich},{type:"image",src:s_bg},{type:"image",src:s_gamebg},{type:"image",src:s_array1},{type:"image",src:s_array2},{type:"image",src:s_array3},{type:"image",src:s_array1_big},{type:"image",src:s_array2_big},{type:"image",src:s_array3_big},{type:"image",src:s_accept},{type:"image",src:s_mission1},
{type:"image",src:s_mission2},{type:"image",src:s_mission3},{type:"image",src:s_mission4},{type:"image",src:s_mission_bg},{type:"image",src:s_mission_ruler},{type:"image",src:s_shopbg},{type:"image",src:s_nextgame},{type:"image",src:s_nextgamebig},{type:"image",src:s_bgdouble},{type:"image",src:s_singleplayer},{type:"image",src:s_singleplayerbig},{type:"image",src:s_doubleplayer},{type:"image",src:s_doubleplayerbig},{type:"image",src:s_exitbig},{type:"image",src:s_exit},{type:"fnt",src:s_bitMapChinese},
{type:"image",src:s_bitMapChinesepng},{type:"fnt",src:s_bitmapFontTest3_fnt},{type:"image",src:s_bitmapFontTest3_png},{type:"fnt",src:s_bitmapFontTest5_fnt},{type:"image",src:s_bitmapFontTest5_png},{type:"fnt",src:s_futura_fnt},{type:"image",src:s_futura_png},{type:"plist",src:s_explosion_plist},{type:"bgm",src:s_bgMusic},{type:"bgm",src:s_mainMainMusic},{type:"effect",src:s_buttonEffect},{type:"effect",src:s_explodeEffect},{type:"effect",src:s_fireEffect},{type:"effect",src:s_shipDestroyEffect}];var Theme=[{startlayer_bg:s_background1,gamelayer_bg:s_background3,storelayer_bg:s_background,info_bg:s_background2,menu:s_start_menu,hook:s_hook,big_rock:s_big_rock,small_rock:s_small_rock,big_gold:s_big_gold,middle_gold:s_middle_gold,small_gold:s_small_gold,pig:s_pig,big_diamond:s_big_diamond,small_diamond:s_small_diamond,bomb:s_bomb,bone:s_bone,milk:s_milk,clock:s_clock,money_tree:s_money_tree,rich:s_rich,accept:s_accept,bat:s_bat},{startlayer_bg:s_background1,gamelayer_bg:s_background3,storelayer_bg:s_background,
info_bg:s_background2,menu:s_start_menu,hook:s_hook,big_rock:s_big_rock,small_rock:s_small_rock,big_gold:s_big_gold,small_gold:s_small_gold,pig:s_pig,big_diamond:s_big_diamond,small_diamond:s_small_diamond,bomb:s_bomb,bone:s_bone,milk:s_milk,clock:s_clock,money_tree:s_money_tree,rich:s_rich,accept:s_accept}];var winSize=null,keys=[],global={sound:!0,theme:Theme[0],Tag:{Rock:900,Gold:901,Pig:902,Diamond:903,Bone:904,Bat:905,Milk1:906,Milk2:907,Longer:908,Bombshell:909,BoneToGold:910,RockToRich:911,Clock:912,Thunder:913,Sleep:914,Bump:915,Scan:916},zOrder:{Background:-10,Label:20,Miner:25,Hook:30,Rock:41,Gold:42,Pig:43,Bat:70,Diamond:44,Bone:45,Tool:46,Prop:47,Menu:60},debug:!1};var Milk1=cc.Sprite.extend({type:null,value:0,ctor:function(a){var b=getObjectName(a.type);this.type=a.type;this.initWithFile(ToolType[b].image);this.setPosition(cc.ccp(a.x,a.y))},onUse:function(){Game.Speed.retrieve/=2}}),Milk2=cc.Sprite.extend({type:null,value:0,ctor:function(a){var b=getObjectName(a.type);this.type=a.type;this.initWithFile(ToolType[b].image);this.setPosition(cc.ccp(a.x,a.y))},onUse:function(){Game.Speed.retrieve/=4}}),Longer=cc.Sprite.extend({type:null,value:0,ctor:function(a){var b=
getObjectName(a.type);this.type=a.type;this.initWithFile(ToolType[b].image);this.setPosition(cc.ccp(a.x,a.y))},onUse:function(){this.getParent()._hook.initWithFile(s_hook_long);this.getParent()._hook.delegate.initWithFile(s_hook_long);this.getParent()._hook.setAnchorPoint(cc.ccp(0.5,1));this.getParent()._hook.delegate.setAnchorPoint(cc.ccp(0.5,1));this.getParent()._hook2&&(this.getParent()._hook2.initWithFile(s_hook_long),this.getParent()._hook2.delegate.initWithFile(s_hook_long),this.getParent()._hook2.setAnchorPoint(cc.ccp(0.5,
1)),this.getParent()._hook2.delegate.setAnchorPoint(cc.ccp(0.5,1)))}}),Bombshell=cc.Layer.extend({type:null,value:0,ctor:function(a){var b=getObjectName(a.type);this.type=a.type;var c=cc.Sprite.create(ToolType[b].image),d=cc.Sprite.create(ToolType[b].image),b=cc.Sprite.create(ToolType[b].image),c=cc.MenuItemSprite.create(c,d,b,this,this.onUse),c=cc.Menu.create(c,null);c.setAnchorPoint(cc.ccp(0));c.setPosition(cc.ccp(0,0));this.setPosition(cc.ccp(a.x,a.y));this.addChild(c,global.Tag.Tool,2);this.useAction=
cc.MoveTo.create(0.3,cc.ccp(160,350))},onUse:function(a){var b,c;null==a&&(a=1);if(1==a)b=this.getParent()._hook,c=this.getParent().collectedObject;else if(2==a)b=this.getParent()._hook2,c=this.getParent().collectedObject2;if(null!=c&&"retrieve"==b.state){b.stopAllActions();c.stopAllActions();b.setPosition(b.getOriginPosition());cc.RotateBy.create(0.6,1080);var d=new cc.Sprite.create(s_burst);d.setScale(0.4);d.setPosition(c.getPosition());this.getParent().addChild(d,20);var e=this;setTimeout(function(){e.getParent().removeChild(d)},
3E3);console.log("Bombshell used");b.retrieveAction={};b.retrieveAction.isDone=function(){return!0};c.collectAction={};c.collectAction.isDone=function(){return!0};b.swing()}}}),BoneToGold=cc.Sprite.extend({type:null,value:0,ctor:function(a){var b=getObjectName(a.type);this.type=a.type;this.initWithFile(ToolType[b].image);this.setPosition(cc.ccp(a.x,a.y))},onUse:function(){for(var a=this.getParent().mineContainer,b=0;b<a.length;b++)if(a[b].type==global.Tag.Bone){var c={};c.x=a[b].getPositionX();c.y=
a[b].getPositionY();c.type=global.Tag.Gold;c=new MineType.Gold.create(c,1);a[b].removeFromParentAndCleanup();this.getParent().addChild(c,global.zOrder.Gold);a[b]=c}}}),RockToRich=cc.Sprite.extend({type:null,value:0,ctor:function(a){var b=getObjectName(a.type);this.type=a.type;this.initWithFile(ToolType[b].image);this.setPosition(cc.ccp(a.x,a.y))},onUse:function(){for(var a=this.getParent().getChildren(),b=0;b<a.length;b++)a[b].type==global.Tag.Rock&&(a[b].value*=2)}}),Sort=cc.Sprite.extend({type:null,
value:0,ctor:function(a){var b=getObjectName(a.type);this.type=a.type;this.initWithFile(ToolType[b].image);this.setPosition(cc.ccp(a.x,a.y))},onUse:function(){for(var a=100,b=100,c=this.getParent().getChildren(),d=0;d<c.length;d++)c[d].type>=global.Tag.Rock&&c[d].type<=global.Tag.Bomb&&(c[d].stopAllActions(),c[d].setPosition(cc.ccp(b,a)),b+=100,b>=winSize.width&&(b=100,a+=100))}});var PropObject=cc.Sprite.extend({type:null,weight:150,value:0,getCollisionLength:function(){var a=this.getContentSize().width,b=this.getContentSize().height;return a<b?a*this.getScale():b*this.getScale()},getValue:function(){return this.value},getWeight:function(){return this.weight},update:function(){this.collectAction&&this.collectAction.isDone()&&(this.use(),this.getParent().removeChild(this))}}),Clock=PropObject.extend({ctor:function(a){this.initWithFile(PropType.Clock.image);this.setScale(0.5);
this.setPosition(cc.ccp(a.x,a.y));this.type=a.type;this.scheduleUpdate()},use:function(){var a=this.getParent();clearInterval(a._roundInterval);setTimeout(function(){if(0<=a._time_limit)a._roundInterval=setInterval(function(){a._time_limit--;a._lbTime.setString("Time: 00:"+a._time_limit)},1E3)},1E4)}}),Bump=PropObject.extend({ctor:function(a){this.initWithFile(s_milk);this.setPosition(cc.ccp(a.x,a.y));this.type=a.type;this.setScale(0.4);this.scheduleUpdate()},use:function(){var a=this.getParent(),
b=a._hook2?function(){if("launch"==a._hook.getState())for(var b=null,d=0;d<a.mineContainer.length;d++)if(null!=a.mineContainer[d]){var b=Math.pow(a._hook.getPositionX()-a.mineContainer[d].getPositionX(),2),e=Math.pow(a._hook.getPositionY()-a.mineContainer[d].getPositionY(),2),b=Math.sqrt(b+e);b<a.mineContainer[d].getCollisionLength+10&&a._hook.retrieve()}if("launch"==a._hook2.getState())for(d=0;d<a.mineContainer.length;d++)null!=a.mineContainer[d]&&(b=Math.pow(a._hook2.getPositionX()-a.mineContainer[d].getPositionX(),
2),e=Math.pow(a._hook2.getPositionY()-a.mineContainer[d].getPositionY(),2),b=Math.sqrt(b+e),b<a.mineContainer[d].getCollisionLength+10&&a._hook2.retrieve())}:function(){if("launch"==a._hook.getState())for(var b=null,d=0;d<a.mineContainer.length;d++)if(null!=a.mineContainer[d]){var b=Math.pow(a._hook.getPositionX()-a.mineContainer[d].getPositionX(),2),e=Math.pow(a._hook.getPositionY()-a.mineContainer[d].getPositionY(),2),b=Math.sqrt(b+e);40>b&&a._hook.retrieve()}};a.schedule(b);setTimeout(function(){a.unschedule(b)},
1E4)}}),Scan=PropObject.extend({ctor:function(a){this.initWithFile(s_milk);this.setPosition(cc.ccp(a.x,a.y));this.type=a.type;this.setScale(0.4);this.scheduleUpdate()},use:function(){var a=this.getParent().draw,b=this.getParent();b.draw=b._hook2?function(){cc.renderContext.strokeStyle="#3f3e3e";var a=this._hook.delegate.getRotation(),b=this._hook.getOriginPosition().x,e=this._hook.getOriginPosition().y,f,g;a>this._criticalAngle?(f=10,g=e-Math.tan((90-a)*Math.PI/180)*b):a<this._criticalAngle&&0<a?
(f=b-Math.tan(a*Math.PI/180)*e,g=10):a>-this._criticalAngle&&0>a?(f=b+Math.tan(-a*Math.PI/180)*e,g=10):a<-this._criticalAngle&&(f=winSize.width-10,g=e-Math.tan((90+a)*Math.PI/180)*b);cc.drawingUtil.drawLine(this._hook.getOriginPosition(),cc.ccp(f,g));b=this._hook2.delegate.getRotation();e=this._hook2.getOriginPosition().x;f=this._hook2.getOriginPosition().y;var h,i;b>this._criticalAngle?(h=10,i=f-Math.tan((90-b)*Math.PI/180)*e):a<this._criticalAngle&&0<b?(h=e-Math.tan(b*Math.PI/180)*f,i=10):a>-this._criticalAngle&&
0>b?(h=e+Math.tan(-b*Math.PI/180)*f,i=10):a<-this._criticalAngle&&(h=winSize.width-10,i=f-Math.tan((90+b)*Math.PI/180)*e);cc.drawingUtil.drawLine(this._hook2.getOriginPosition(),cc.ccp(h,i))}:function(){cc.renderContext.strokeStyle="#3f3e3e";var a=this._hook.delegate.getRotation(),b=this._hook.getOriginPosition().x,e=this._hook.getOriginPosition().y,f,g;a>this._criticalAngle?(f=10,g=e-Math.tan((90-a)*Math.PI/180)*b):a<this._criticalAngle&&0<a?(f=b-Math.tan(a*Math.PI/180)*e,g=10):a>-this._criticalAngle&&
0>a?(f=b+Math.tan(-a*Math.PI/180)*e,g=10):a<-this._criticalAngle&&(f=winSize.width-10,g=e-Math.tan((90+a)*Math.PI/180)*b);cc.drawingUtil.drawLine(this._hook.getOriginPosition(),cc.ccp(f,g))};setTimeout(function(){b.draw=a},13E3)}});var MineObject=cc.Sprite.extend({type:null,weight:0,size:0,value:0,action:null,zOrder:0,getCollisionLength:function(){var a=this.getContentSize().width,b=this.getContentSize().height;return a<b?a*this.getScale():b*this.getScale()},getValue:function(){return this.value},getWeight:function(){return this.weight},update:function(){this.collectAction&&this.collectAction.isDone()&&this.getParent().removeChild(this)}}),Gold=MineObject.extend({ctor:function(a,b){var c=getObjectName(a.type),b=Math.floor(3*
Math.random());if(1==b){var d=cc.TextureCache.sharedTextureCache().addImage(s_cow),e=cc.SpriteFrame.create(d,cc.RectMake(0,0,324,200));this.initWithSpriteFrame(e);this.value=MineType[c].big.value;this.weight=MineType[c].big.weight;this.setScale(0.7);var f=cc.SpriteFrame.create(d,cc.RectMake(0,200,324,200)),d=cc.SpriteFrame.create(d,cc.RectMake(0,400,324,200)),g=[];g.push(e);g.push(f);g.push(d);e=cc.Animation.create(g,0.5);e=cc.Animate.create(e,!1)}else 2==b?(g=cc.TextureCache.sharedTextureCache().addImage(s_sheep),
e=cc.SpriteFrame.create(g,cc.RectMake(0,0,110,170)),this.initWithSpriteFrame(e),this.value=MineType[c].middle.value,this.weight=MineType[c].middle.weight,this.setScale(0.7),f=cc.SpriteFrame.create(g,cc.RectMake(117,0,130,170)),d=cc.SpriteFrame.create(g,cc.RectMake(251,0,130,170)),cc.SpriteFrame.create(g,cc.RectMake(387,0,130,170)),g=[],g.push(e),g.push(f),g.push(d),e=cc.Animation.create(g,0.5),e=cc.Animate.create(e,!1)):(e=cc.JumpBy.create(1,cc.PointMake(0,0),5,1),this.initWithFile(MineType[c].small.image),
this.value=MineType[c].small.value,this.weight=MineType[c].small.weight);this.setPosition(cc.ccp(a.x,a.y));this.runAction(cc.RepeatForever.create(e));this.setScale(0.4);this.type=a.type;this.zOrder=global.zOrder[c];this.scheduleUpdate()}}),Rock=MineObject.extend({ctor:function(a,b){var c=getObjectName(a.type);1==b?(this.initWithFile(MineType[c].big.image),this.value=MineType[c].big.value,this.weight=MineType[c].big.weight):(this.initWithFile(MineType[c].small.image),this.value=MineType[c].small.value,
this.weight=MineType[c].small.weight);this.setPosition(cc.ccp(a.x,a.y));this.type=a.type;this.setScale(0.5);this.zOrder=global.zOrder[c];this.scheduleUpdate()}}),Diamond=MineObject.extend({ctor:function(a,b){var c=getObjectName(a.type);if(1==b){var d=cc.TextureCache.sharedTextureCache().addImage(s_animals),e=cc.SpriteFrame.create(d,cc.RectMake(0,0,90,130));this.initWithSpriteFrame(e);this.value=MineType[c].big.value;this.weight=MineType[c].big.weight;this.setScale(0.9);var f=cc.SpriteFrame.create(d,
cc.RectMake(103,0,90,130)),g=cc.SpriteFrame.create(d,cc.RectMake(1,136,85,130)),d=cc.SpriteFrame.create(d,cc.RectMake(103,136,90,130)),h=[];h.push(e);h.push(f);h.push(g);h.push(d);e=cc.Animation.create(h,0.5);e=cc.Animate.create(e,!1);this.runAction(cc.RepeatForever.create(e))}else this.initWithFile(MineType[c].small.image),this.value=MineType[c].small.value,this.weight=MineType[c].small.weight;this.setPosition(cc.ccp(a.x,a.y));this.type=a.type;this.setScale(0.6);this.zOrder=global.zOrder[c];this.scheduleUpdate()}}),
Bone=MineObject.extend({ctor:function(a){var b=getObjectName(a.type);this.initWithFile(MineType[b].image);this.value=MineType[b].value;this.weight=MineType[b].weight;this.setPosition(cc.ccp(a.x,a.y));this.type=a.type;this.setScale(0.3);this.zOrder=global.zOrder[b];this.scheduleUpdate()}}),Pig=MineObject.extend({ctor:function(a){var b=getObjectName(a.type),c=cc.TextureCache.sharedTextureCache().addImage(s_dog),d=cc.SpriteFrame.create(c,cc.RectMake(0,0,237,159));this.initWithSpriteFrame(d);this.value=
MineType[b].value;this.weight=MineType[b].weight;this.setPosition(cc.ccp(a.x,a.y));this.type=a.type;this.setScale(0.3);var c=cc.SpriteFrame.create(c,cc.RectMake(0,159,237,159)),e=[];e.push(d);e.push(c);d=cc.Animation.create(e,0.5);d=cc.Animate.create(d,!1);this.runAction(cc.RepeatForever.create(d));d=cc.ccp(a.x,a.y);a=cc.ccp(winSize.width-a.x,a.y2);cc.Point.CCPointEqualToPoint(d,a)||(e=10*(Math.abs(a.x-d.x)/winSize.width),c=cc.MoveTo.create(e,a),e=cc.MoveTo.create(e,d),a=d.x>a.x?cc.Sequence.create(c,
cc.DelayTime.create(0.2),cc.FlipX.create(!0),e,cc.DelayTime.create(0.2),cc.FlipX.create(!1)):cc.Sequence.create(cc.FlipX.create(!0),c,cc.DelayTime.create(0.2),cc.FlipX.create(!1),e,cc.DelayTime.create(0.2)),this.runAction(cc.RepeatForever.create(a,null)));this.zOrder=global.zOrder[b];this.scheduleUpdate()}}),Bat=MineObject.extend({ctor:function(a){var b=getObjectName(a.type),c=cc.TextureCache.sharedTextureCache().addImage(s_bat),d=cc.SpriteFrame.create(c,cc.RectMake(0,0,212,109)),c=cc.SpriteFrame.create(c,
cc.RectMake(0,109,212,109));this.initWithSpriteFrame(d);this.value=MineType[b].value;this.weight=MineType[b].weight;this.setPosition(cc.ccp(a.x,a.y));this.type=a.type;this.setScale(0.3);var e=[];e.push(d);e.push(c);d=cc.Animation.create(e,0.5);d=cc.Animate.create(d,!1);this.runAction(cc.RepeatForever.create(d));d=cc.ccp(a.x,a.y);a=cc.ccp(a.x2,a.y2);cc.Point.CCPointEqualToPoint(d,a)||(a=cc.MoveTo.create(4,a),d=cc.MoveTo.create(4,d),a=cc.Sequence.create(a,cc.DelayTime.create(0.3),d,cc.DelayTime.create(0.3)),
this.runAction(cc.RepeatForever.create(a)));this.zOrder=global.zOrder[b];this.scheduleUpdate()}});var MineType={Rock:{create:Rock,big:{value:40,weight:800,image:global.theme.big_rock},small:{value:20,weight:400,image:global.theme.small_rock}},Gold:{create:Gold,big:{value:500,weight:800,image:global.theme.big_gold},middle:{value:250,weight:400,image:global.theme.middle_gold},small:{value:150,weight:200,image:global.theme.small_gold}},Pig:{create:Pig,value:100,weight:200,image:global.theme.pig},Diamond:{create:Diamond,big:{value:800,weight:150,image:global.theme.big_diamond},small:{value:700,weight:50,
image:global.theme.small_diamond}},Bone:{create:Bone,value:80,weight:200,image:global.theme.bone},Bat:{create:Bat,value:50,weight:200,image:global.theme.bat}},ToolType={Milk1:{create:Milk1,value:500,image:s_milk1},Milk2:{create:Milk2,value:2E3,image:s_milk2},Longer:{create:Longer,value:500,image:s_aim},Bombshell:{create:Bombshell,value:800,image:s_bomb},BoneToGold:{create:BoneToGold,value:800,image:s_bonebook},RockToRich:{create:RockToRich,value:200,image:s_stonebook}},PropType={Clock:{create:Clock,
image:s_clock},Bump:{create:Bump,image:s_milk},Scan:{create:Scan,image:s_milk}},getObjectName=function(a){return"Rock,Gold,Pig,Diamond,Bone,Bat,Milk1,Milk2,Longer,Bombshell,BoneToGold,RockToRich,Clock,Thunder,Sleep,Bump,Scan".split(",")[a-global.Tag.Rock]},getMineType=function(){function a(b){if(null==b||"object"!=typeof b)return b;if(b instanceof Array){for(var c=[],d=0,e=b.length;d<e;++d)c[d]=a(b[d]);return c}if(b instanceof Object){c={};for(d in b)b.hasOwnProperty(d)&&(c[d]=a(b[d]));return c}throw Error("Unable to copy obj! Its type isn't supported.");
}return a(MineType)};var NUMBER_OF_ROUNDS=6,Round=[[[{type:global.Tag.Rock,x:100,y:290},{type:global.Tag.Rock,x:260,y:90},{type:global.Tag.Rock,x:470,y:250},{type:global.Tag.Rock,x:610,y:320},{type:global.Tag.Gold,x:170,y:80},{type:global.Tag.Gold,x:200,y:300},{type:global.Tag.Gold,x:300,y:180},{type:global.Tag.Gold,x:410,y:170},{type:global.Tag.Gold,x:530,y:100},{type:global.Tag.Gold,x:580,y:230},{type:global.Tag.Gold,x:720,y:250}],[{type:global.Tag.Rock,x:90,y:280},{type:global.Tag.Rock,x:280,y:260},{type:global.Tag.Rock,
x:440,y:290},{type:global.Tag.Rock,x:540,y:280},{type:global.Tag.Rock,x:390,y:180},{type:global.Tag.Gold,x:70,y:110},{type:global.Tag.Gold,x:230,y:320},{type:global.Tag.Gold,x:420,y:60},{type:global.Tag.Gold,x:520,y:230},{type:global.Tag.Gold,x:190,y:150},{type:global.Tag.Gold,x:690,y:50},{type:global.Tag.Gold,x:730,y:190}],[{type:global.Tag.Rock,x:90,y:250},{type:global.Tag.Rock,x:200,y:260},{type:global.Tag.Rock,x:340,y:300},{type:global.Tag.Rock,x:440,y:240},{type:global.Tag.Rock,x:620,y:280},
{type:global.Tag.Rock,x:590,y:130},{type:global.Tag.Gold,x:80,y:90},{type:global.Tag.Gold,x:280,y:130},{type:global.Tag.Gold,x:370,y:100},{type:global.Tag.Gold,x:480,y:140},{type:global.Tag.Gold,x:700,y:110},{type:global.Tag.Pig,x:50,y:280,x2:50,y2:300},{type:global.Tag.Pig,x:90,y:320,x2:90,y2:350},{type:global.Tag.Pig,x:550,y:200,x2:550,y2:200},{type:global.Tag.Pig,x:550,y:310,x2:550,y2:310},{type:global.Tag.Diamond,x:170,y:110}],[{type:global.Tag.Rock,x:90,y:150},{type:global.Tag.Rock,x:180,y:210},
{type:global.Tag.Rock,x:340,y:240},{type:global.Tag.Rock,x:520,y:230},{type:global.Tag.Rock,x:600,y:100},{type:global.Tag.Gold,x:110,y:40},{type:global.Tag.Gold,x:260,y:150},{type:global.Tag.Gold,x:460,y:160},{type:global.Tag.Gold,x:630,y:180},{type:global.Tag.Gold,x:710,y:190},{type:global.Tag.Pig,x:50,y:300,x2:50,y2:300},{type:global.Tag.Pig,x:90,y:340,x2:90,y2:350},{type:global.Tag.Pig,x:550,y:240,x2:550,y2:200},{type:global.Tag.Pig,x:550,y:310,x2:550,y2:310},{type:global.Tag.Diamond,x:210,y:40},
{type:global.Tag.Diamond,x:580,y:40}],[{type:global.Tag.Rock,x:230,y:240},{type:global.Tag.Rock,x:400,y:290},{type:global.Tag.Rock,x:600,y:100},{type:global.Tag.Rock,x:620,y:300},{type:global.Tag.Gold,x:90,y:70},{type:global.Tag.Gold,x:150,y:170},{type:global.Tag.Gold,x:300,y:70},{type:global.Tag.Gold,x:450,y:150},{type:global.Tag.Gold,x:650,y:200},{type:global.Tag.Pig,x:50,y:260,x2:50,y2:260},{type:global.Tag.Pig,x:450,y:350,x2:450,y2:350},{type:global.Tag.Pig,x:550,y:190,x2:550,y2:190},{type:global.Tag.Pig,
x:100,y:220,x2:100,y2:220},{type:global.Tag.Pig,x:80,y:310,x2:80,y2:310},{type:global.Tag.Bone,x:150,y:300},{type:global.Tag.Bone,x:370,y:260},{type:global.Tag.Bone,x:540,y:300},{type:global.Tag.Diamond,x:580,y:40}],[{type:global.Tag.Gold,x:80,y:50},{type:global.Tag.Gold,x:440,y:130},{type:global.Tag.Gold,x:590,y:80},{type:global.Tag.Gold,x:680,y:320},{type:global.Tag.Diamond,x:30,y:330},{type:global.Tag.Diamond,x:150,y:200},{type:global.Tag.Diamond,x:680,y:60},{type:global.Tag.Bone,x:170,y:300},
{type:global.Tag.Bone,x:370,y:260},{type:global.Tag.Bone,x:540,y:300},{type:global.Tag.Rock,x:100,y:290},{type:global.Tag.Rock,x:230,y:160},{type:global.Tag.Rock,x:440,y:210},{type:global.Tag.Rock,x:590,y:260},{type:global.Tag.Bat,x:250,y:30,x2:250,y2:150},{type:global.Tag.Bat,x:550,y:100,x2:550,y2:220}]],[[{type:global.Tag.Rock,x:100,y:290},{type:global.Tag.Rock,x:260,y:90},{type:global.Tag.Rock,x:470,y:220},{type:global.Tag.Rock,x:300,y:290},{type:global.Tag.Rock,x:460,y:290},{type:global.Tag.Rock,
x:320,y:150},{type:global.Tag.Gold,x:100,y:210},{type:global.Tag.Gold,x:140,y:340},{type:global.Tag.Gold,x:170,y:140},{type:global.Tag.Gold,x:200,y:300},{type:global.Tag.Gold,x:580,y:170},{type:global.Tag.Gold,x:530,y:100},{type:global.Tag.Gold,x:530,y:230},{type:global.Tag.Gold,x:590,y:310},{type:global.Tag.Gold,x:660,y:250}],[{type:global.Tag.Rock,x:90,y:240},{type:global.Tag.Rock,x:280,y:210},{type:global.Tag.Rock,x:440,y:240},{type:global.Tag.Rock,x:520,y:340},{type:global.Tag.Rock,x:300,y:300},
{type:global.Tag.Rock,x:620,y:230},{type:global.Tag.Rock,x:170,y:140},{type:global.Tag.Rock,x:400,y:140},{type:global.Tag.Gold,x:30,y:110},{type:global.Tag.Gold,x:110,y:170},{type:global.Tag.Gold,x:170,y:240},{type:global.Tag.Gold,x:290,y:80},{type:global.Tag.Gold,x:380,y:110},{type:global.Tag.Gold,x:490,y:300},{type:global.Tag.Gold,x:540,y:240},{type:global.Tag.Gold,x:630,y:110},{type:global.Tag.Gold,x:690,y:250}],[{type:global.Tag.Rock,x:90,y:250},{type:global.Tag.Rock,x:280,y:260},{type:global.Tag.Rock,
x:440,y:240},{type:global.Tag.Rock,x:620,y:280},{type:global.Tag.Rock,x:340,y:290},{type:global.Tag.Gold,x:50,y:130},{type:global.Tag.Gold,x:250,y:70},{type:global.Tag.Gold,x:460,y:80},{type:global.Tag.Gold,x:590,y:80},{type:global.Tag.Gold,x:710,y:140},{type:global.Tag.Pig,x:50,y:280,x2:50,y2:300},{type:global.Tag.Pig,x:90,y:320,x2:90,y2:350},{type:global.Tag.Pig,x:550,y:200,x2:550,y2:200},{type:global.Tag.Pig,x:550,y:310,x2:550,y2:310},{type:global.Tag.Diamond,x:170,y:90}],[{type:global.Tag.Rock,
x:90,y:200},{type:global.Tag.Rock,x:180,y:260},{type:global.Tag.Rock,x:540,y:290},{type:global.Tag.Rock,x:390,y:290},{type:global.Tag.Rock,x:620,y:280},{type:global.Tag.Rock,x:600,y:180},{type:global.Tag.Gold,x:100,y:110},{type:global.Tag.Gold,x:250,y:120},{type:global.Tag.Gold,x:460,y:150},{type:global.Tag.Gold,x:630,y:130},{type:global.Tag.Pig,x:50,y:300,x2:50,y2:300},{type:global.Tag.Pig,x:90,y:340,x2:90,y2:350},{type:global.Tag.Pig,x:550,y:240,x2:550,y2:200},{type:global.Tag.Diamond,x:100,y:30},
{type:global.Tag.Diamond,x:580,y:50}],[{type:global.Tag.Rock,x:230,y:240},{type:global.Tag.Rock,x:400,y:290},{type:global.Tag.Rock,x:600,y:100},{type:global.Tag.Rock,x:620,y:300},{type:global.Tag.Gold,x:70,y:50},{type:global.Tag.Gold,x:150,y:170},{type:global.Tag.Gold,x:300,y:30},{type:global.Tag.Gold,x:450,y:150},{type:global.Tag.Diamond,x:650,y:200},{type:global.Tag.Pig,x:50,y:230,x2:50,y2:230},{type:global.Tag.Pig,x:450,y:330,x2:450,y2:330},{type:global.Tag.Pig,x:550,y:100,x2:550,y2:100},{type:global.Tag.Pig,
x:100,y:180,x2:100,y2:180},{type:global.Tag.Pig,x:80,y:320,x2:80,y2:320},{type:global.Tag.Bone,x:150,y:300},{type:global.Tag.Bone,x:370,y:260},{type:global.Tag.Bone,x:540,y:300}],[{type:global.Tag.Gold,x:50,y:70},{type:global.Tag.Gold,x:460,y:130},{type:global.Tag.Gold,x:600,y:80},{type:global.Tag.Diamond,x:30,y:330},{type:global.Tag.Diamond,x:150,y:40},{type:global.Tag.Diamond,x:730,y:180},{type:global.Tag.Bone,x:190,y:300},{type:global.Tag.Bone,x:370,y:260},{type:global.Tag.Bone,x:540,y:300},{type:global.Tag.Rock,
x:100,y:290},{type:global.Tag.Rock,x:230,y:160},{type:global.Tag.Rock,x:440,y:210},{type:global.Tag.Rock,x:590,y:260},{type:global.Tag.Bat,x:250,y:30,x2:550,y2:150},{type:global.Tag.Bat,x:550,y:100,x2:250,y2:220}]],[[{type:global.Tag.Rock,x:180,y:320},{type:global.Tag.Rock,x:260,y:90},{type:global.Tag.Rock,x:470,y:250},{type:global.Tag.Rock,x:310,y:300},{type:global.Tag.Rock,x:230,y:190},{type:global.Tag.Rock,x:570,y:270},{type:global.Tag.Rock,x:330,y:200},{type:global.Tag.Gold,x:70,y:210},{type:global.Tag.Gold,
x:100,y:310},{type:global.Tag.Gold,x:170,y:140},{type:global.Tag.Gold,x:250,y:250},{type:global.Tag.Gold,x:300,y:160},{type:global.Tag.Gold,x:410,y:170},{type:global.Tag.Gold,x:530,y:100},{type:global.Tag.Gold,x:600,y:230},{type:global.Tag.Gold,x:640,y:290},{type:global.Tag.Gold,x:720,y:250}],[{type:global.Tag.Rock,x:90,y:240},{type:global.Tag.Rock,x:280,y:210},{type:global.Tag.Rock,x:440,y:240},{type:global.Tag.Rock,x:520,y:340},{type:global.Tag.Rock,x:140,y:300},{type:global.Tag.Rock,x:300,y:290},
{type:global.Tag.Gold,x:110,y:170},{type:global.Tag.Gold,x:160,y:350},{type:global.Tag.Gold,x:250,y:80},{type:global.Tag.Gold,x:380,y:110},{type:global.Tag.Gold,x:540,y:240},{type:global.Tag.Gold,x:630,y:110},{type:global.Tag.Gold,x:690,y:250}],[{type:global.Tag.Rock,x:90,y:250},{type:global.Tag.Rock,x:40,y:150},{type:global.Tag.Rock,x:280,y:260},{type:global.Tag.Rock,x:440,y:240},{type:global.Tag.Rock,x:620,y:280},{type:global.Tag.Rock,x:180,y:140},{type:global.Tag.Rock,x:390,y:120},{type:global.Tag.Rock,
x:540,y:140},{type:global.Tag.Rock,x:700,y:200},{type:global.Tag.Diamond,x:80,y:50},{type:global.Tag.Gold,x:370,y:40},{type:global.Tag.Diamond,x:460,y:80},{type:global.Tag.Diamond,x:630,y:110},{type:global.Tag.Pig,x:50,y:280,x2:50,y2:300},{type:global.Tag.Pig,x:90,y:320,x2:90,y2:350},{type:global.Tag.Pig,x:550,y:200,x2:550,y2:200},{type:global.Tag.Pig,x:550,y:310,x2:550,y2:310},{type:global.Tag.Bat,x:50,y:240,x2:550,y2:200},{type:global.Tag.Bat,x:50,y:310,x2:550,y2:310},{type:global.Tag.Diamond,x:270,
y:90}],[{type:global.Tag.Rock,x:90,y:150},{type:global.Tag.Rock,x:60,y:250},{type:global.Tag.Rock,x:180,y:210},{type:global.Tag.Rock,x:200,y:110},{type:global.Tag.Rock,x:300,y:130},{type:global.Tag.Rock,x:340,y:240},{type:global.Tag.Rock,x:520,y:230},{type:global.Tag.Rock,x:600,y:100},{type:global.Tag.Rock,x:620,y:180},{type:global.Tag.Gold,x:690,y:180},{type:global.Tag.Rock,x:300,y:310},{type:global.Tag.Rock,x:500,y:300},{type:global.Tag.Rock,x:650,y:300},{type:global.Tag.Gold,x:110,y:40},{type:global.Tag.Diamond,
x:410,y:150},{type:global.Tag.Pig,x:50,y:280,x2:50,y2:280},{type:global.Tag.Pig,x:90,y:340,x2:90,y2:350},{type:global.Tag.Pig,x:550,y:240,x2:550,y2:200},{type:global.Tag.Pig,x:550,y:310,x2:550,y2:310},{type:global.Tag.Bat,x:50,y:240,x2:550,y2:200},{type:global.Tag.Bat,x:50,y:310,x2:550,y2:310},{type:global.Tag.Diamond,x:210,y:40},{type:global.Tag.Diamond,x:400,y:70},{type:global.Tag.Diamond,x:500,y:200}],[{type:global.Tag.Rock,x:60,y:250},{type:global.Tag.Rock,x:180,y:210},{type:global.Tag.Rock,x:200,
y:110},{type:global.Tag.Rock,x:300,y:130},{type:global.Tag.Rock,x:340,y:240},{type:global.Tag.Rock,x:520,y:230},{type:global.Tag.Rock,x:600,y:100},{type:global.Tag.Rock,x:620,y:180},{type:global.Tag.Gold,x:70,y:50},{type:global.Tag.Gold,x:150,y:170},{type:global.Tag.Gold,x:300,y:30},{type:global.Tag.Gold,x:450,y:150},{type:global.Tag.Gold,x:690,y:200},{type:global.Tag.Diamond,x:200,y:40},{type:global.Tag.Diamond,x:450,y:70},{type:global.Tag.Diamond,x:680,y:40},{type:global.Tag.Bat,x:50,y:350,x2:750,
y2:350},{type:global.Tag.Bat,x:50,y:210,x2:750,y2:210},{type:global.Tag.Bat,x:100,y:240,x2:700,y2:240},{type:global.Tag.Bone,x:150,y:300},{type:global.Tag.Bone,x:400,y:260},{type:global.Tag.Bone,x:540,y:300}],[{type:global.Tag.Rock,x:60,y:250},{type:global.Tag.Rock,x:180,y:210},{type:global.Tag.Rock,x:300,y:130},{type:global.Tag.Rock,x:520,y:230},{type:global.Tag.Rock,x:620,y:180},{type:global.Tag.Diamond,x:690,y:180},{type:global.Tag.Rock,x:500,y:300},{type:global.Tag.Rock,x:650,y:300},{type:global.Tag.Gold,
x:360,y:200},{type:global.Tag.Gold,x:460,y:150},{type:global.Tag.Gold,x:550,y:80},{type:global.Tag.Diamond,x:650,y:250},{type:global.Tag.Diamond,x:30,y:330},{type:global.Tag.Diamond,x:150,y:240},{type:global.Tag.Diamond,x:200,y:100},{type:global.Tag.Diamond,x:100,y:150},{type:global.Tag.Bone,x:150,y:300},{type:global.Tag.Bone,x:370,y:260},{type:global.Tag.Bone,x:540,y:300},{type:global.Tag.Bat,x:250,y:30,x2:250,y2:150},{type:global.Tag.Bat,x:250,y:100,x2:250,y2:220},{type:global.Tag.Bat,x:250,y:170,
x2:250,y2:290},{type:global.Tag.Bat,x:250,y:240,x2:250,y2:360},{type:global.Tag.Bat,x:550,y:30,x2:550,y2:150},{type:global.Tag.Bat,x:550,y:100,x2:550,y2:220},{type:global.Tag.Bat,x:550,y:170,x2:550,y2:290},{type:global.Tag.Bat,x:550,y:240,x2:550,y2:360}]]],NUMBER_OF_MISSIONS=3;Mission=[{round:Round,image:s_mission4,props:["Clock","Bump","Scan"]},{round:Round,image:s_mission2,props:["Clock","Bump","Scan"]},{round:Round,image:s_mission3,props:["Clock","Bump","Scan"]}];var Game={round:1,mission:1,unlock:3,cur_score:0,dst_score:500,time_limit:30,toolContainer:[],describe:null,gameMode:null,difficulty:1,Speed:{rotate:2,launch:1,retrieve:1},resume:function(){this.mission=this.round=1;this.cur_score=0;this.dst_score=500;this.time_limit=30;this.cleanToolObjects()},cleanToolObjects:function(){this.toolContainer=[];this.Speed.launch=1;this.Speed.retrieve=1},popToolObject:function(a){for(var b=[],c=0,d=0;d<this.toolContainer.length;d++)this.toolContainer[d].type!=a&&(b[c++]=
this.toolContainer[d]);this.toolContainer=b}};(function(){if("undefined"!==typeof Storage){if(null==localStorage.unlockMission)localStorage.unlockMission=1;if(null==localStorage.record)localStorage.record=[0,0,0];if(null==localStorage.yourScore)localStorage.yourScore=0}else console.error("Sorry! No web storage support..")})();var Hook=cc.Sprite.extend({state:"init",rotateLimit:80,rotateSpeed:1,launchSpeed:1,retrieveSpeed:1,swingAction:null,launchAction:null,retrieveAction:null,originPosition:null,delegate:null,ctor:function(){this._super();this.initWithFile(global.theme.hook);this.initDelegate();this.setScale(0.6);this.rotateSpeed=Game.Speed.rotate;this.launchSpeed=Game.Speed.launch;this.retrieveSpeed=Game.Speed.retrieve;this.swing()},initDelegate:function(){this.delegate=new cc.Sprite.create(global.theme.hook);this.delegate.setScale(0.6);
this.delegate.setIsVisible(!1);this.delegate.setAnchorPoint(cc.ccp(0.5,1))},swing:function(){if("init"==this.state){this.state="swing";this.setRotation(0);this.rotateSpeed=Game.Speed.rotate;var a=cc.RotateTo.create(this.rotateSpeed,this.rotateLimit),b=cc.RotateTo.create(this.rotateSpeed,-this.rotateLimit),a=cc.Sequence.create(a,cc.DelayTime.create(0.2),b,cc.DelayTime.create(0.2));this.swingAction=cc.RepeatForever.create(a);this.setIsVisible(!1);this.delegate.setIsVisible(!0);this.delegate.runAction(this.swingAction)}else"retrieve"==
this.state&&this.retrieveAction&&this.retrieveAction.isDone()?(this.state="swing",this.setIsVisible(!1),this.delegate.setIsVisible(!0),this.delegate.resumeSchedulerAndActions()):console.error("Swing could only started from after either a retrieve or init state.")},stopSwing:function(){"swing"==this.state?(this.delegate.pauseSchedulerAndActions(),this.setRotation(this.delegate.getRotation()),this.delegate.setIsVisible(!1),this.setIsVisible(!0)):console.error("Could not stop swing other than in a swing state.")},
launch:function(a){"swing"==this.state?(this.state="launch",this.launchSpeed=Game.Speed.launch,this.launchAction=cc.MoveTo.create(this.launchSpeed,a),this.runAction(this.launchAction)):console.error("Launch could only be started from a swing state.")},stopLaunch:function(){"launch"==this.state?this.stopAction(this.launchAction):console.error("Could not stop a launch state other than in a launch state.")},retrieve:function(a){if(this.lauchAction&&this.launchAction.isDone()||"launch"==this.state){this.state=
"retrieve";this.stopAction(this.launchAction);if(null==a)a=Game.Speed.retrieve;this.retrieveAction=cc.MoveTo.create(a,this.originPosition);this.runAction(this.retrieveAction)}else console.error("Retrieve could only be started from a launch state, or when the launch is finished")},getState:function(){return this.state},setRetrieveSpeed:function(a){if(a&&0<a)this.retrieveSpeed=a},getRetrieveSpeed:function(){return this.retrieveSpeed},getOriginPosition:function(){return this.originPosition},getPositionX:function(){return this.getPosition().x-
Math.sin(this.delegate.getRotation()*Math.PI/180)*this.getContentSize().height*this.getScale()},getPositionY:function(){return this.getPosition().y-Math.cos(this.delegate.getRotation()*Math.PI/180)*this.getContentSize().height*this.getScale()},getCollectPosition:function(){var a=this.getOriginPosition().x-Math.sin(this.delegate.getRotation()*Math.PI/180)*this.getContentSize().height*this.getScale(),b=this.getOriginPosition().y-Math.cos(this.delegate.getRotation()*Math.PI/180)*this.getContentSize().height*
this.getScale();return cc.ccp(a,b)},update:function(){this.launchAction&&this.launchAction.isDone()&&"launch"==this.state?(Game.Speed.retrieve=1,this.retrieve()):this.retrieveAction&&this.retrieveAction.isDone()&&"retrieve"==this.state&&this.swing();null==this.delegate.getParent()&&this.getParent().addChild(this.delegate,this.getZOrder()+1);cc.Point.CCPointEqualToPoint(this.getPosition(),this.delegate.getPosition)||this.delegate.setPosition(this.getPosition())}});Miner=cc.Sprite.extend({ctor:function(){}});Seller=cc.Sprite.extend({ctor:function(){}});var cc=cc=cc||{};cc.AppDelegate=cc.Application.extend({ctor:function(){this._super()},initInstance:function(){return!0},applicationDidFinishLaunching:function(){var a=cc.Director.sharedDirector();a.setDisplayFPS(!0);a.setAnimationInterval(1/60);var b=StartLayer.scene();a.runWithScene(b);return!0},applicationDidEnterBackground:function(){cc.Director.sharedDirector().pause()},applicationWillEnterForeground:function(){cc.Director.sharedDirector().resume()}});var uc=function(a){var a=a||{source:{},target:{}},b=a.mode||"not_reserve_ratio",c=a.source.width||800,d=a.source.height||480,e=a.target.width||800,a=a.target.height||480,f=1,g=1,h=1,h=c/d>e/a?e/c:a/d,f=e/c,g=a/d;console.log(c,d,e,a,h,f,g);return{trPoint:function(a){var c={};if("reserve_ratio"===b)c.x=a.x*h,c.y=a.y*h;else if("not_reserve_ratio"===b)c.x=a.x*f,console.log(f,c.x,a.x),c.y=a.y*g,console.log(g);return c},trScale:function(a){return a*h},tr:function(a){return a*h},trX:function(a){return a*
f},trY:function(a){return a*g}}}({orientation:"landscape",mode:"not_reserve_ratio",source:{width:800,height:480},target:{width:400,height:240}});(function(a,b){var b=b||{source:{},target:{}},c=b.source.width||800,d=b.source.height||480,e=b.target.width||800,f=b.target.height||480,g=1,g=g=1;console.log(c,d,e,f,c/d>e/f?e/c:f/d,e/c,f/d)})(cc=cc=cc||{},{orientation:"landscape",mode:"reserve_ratio",source:{width:800,height:480},target:{width:400,height:240}});var additiveSprite=cc.Sprite.extend({draw:function(a){(a||cc.renderContext).globalCompositeOperation="lighter";this._super(a)}}),flareEffect=function(a,b,c){var d=new additiveSprite;d.initWithFile(s_flare);a.addChild(d,10);d.setOpacity(0);d.setPosition(cc.ccp(-30,297));d.setRotation(-120);d.setScale(0.2);var a=cc.FadeTo.create(0.5,255),e=cc.FadeTo.create(1,0),f=cc.ScaleBy.create(0.7,1.2,1.2),f=cc.EaseSineOut.create(f),g=cc.MoveBy.create(0.5,cc.ccp(328,0)),g=cc.EaseSineOut.create(g),h=cc.RotateBy.create(2.5,
90),h=cc.EaseExponentialOut.create(h),i=cc.ScaleTo.create(0.5,1),b=cc.CallFunc.create(b,c),c=cc.CallFunc.create(d,function(){this.getParent().removeChild(this)});d.runAction(cc.Sequence.create(a,f,e,c,b));d.runAction(g);d.runAction(h);d.runAction(i)},spark=function(a,b,c,d){var c=c||0.3,d=d||0.5,e=new additiveSprite;e.initWithFile(s_explode1);var f=new additiveSprite;f.initWithFile(s_explode2);var g=new additiveSprite;g.initWithFile(s_explode3);e.setPosition(a);f.setPosition(a);g.setPosition(a);b.addChild(f);
b.addChild(g);e.setScale(c);f.setScale(c);g.setScale(c);g.setRotation(360*Math.random());var a=cc.RotateBy.create(d,-45),c=cc.RotateBy.create(d,45),h=cc.ScaleBy.create(d,3,3),i=cc.FadeOut.create(d);e.runAction(a);f.runAction(c);e.runAction(h);f.runAction(h.copy());g.runAction(h.copy());e.runAction(i);f.runAction(i.copy());g.runAction(i.copy());setTimeout(function(){b.removeChild(e);b.removeChild(f);b.removeChild(g)},1E3*d)};var Explosion=additiveSprite.extend({tmpWidth:0,tmpHeight:0,ctor:function(){this._super();this.tmpWidth=this.getContentSize().width;this.tmpHeight=this.getContentSize().height;this.initWithSpriteFrame(cc.SpriteFrameCache.sharedSpriteFrameCache().spriteFrameByName("explosion_01.png"));var a=cc.AnimationCache.sharedAnimationCache().animationByName("Explosion");this.runAction(cc.Sequence.create(cc.Animate.create(a,!1),cc.CallFunc.create(this,this.destroy)))},destroy:function(){this.getParent().removeChild(this)}});
Explosion.sharedExplosion=function(){cc.SpriteFrameCache.sharedSpriteFrameCache().addSpriteFramesWithFile(s_explosion_plist);for(var a=[],b="",c=1;35>c;c++)b="explosion_"+(10>c?"0"+c:c)+".png",b=cc.SpriteFrameCache.sharedSpriteFrameCache().spriteFrameByName(b),a.push(b);a=cc.Animation.create(a,0.04);cc.AnimationCache.sharedAnimationCache().addAnimation(a,"Explosion")};var AboutLayer=cc.Layer.extend({init:function(){var a=!1;if(this._super()){a=cc.Sprite.create(s_about);a.setAnchorPoint(cc.PointZero());this.addChild(a,0,1);a=cc.LabelTTF.create("\n A game that play like the Gold Miner.","arial",20);a.setPosition(cc.ccp(winSize.width/2,winSize.height/2+80));this.addChild(a);a=cc.LabelBMFont.create("Programmer","Resources/fonts/bitmapFontTest5.fnt");a.setPosition(cc.ccp(winSize.width/2,270));this.addChild(a);a=cc.LabelBMFont.create("Koh Ou Ping","Resources/fonts/bitmapFontTest5.fnt");
a.setPosition(cc.ccp(winSize.width/2,210));this.addChild(a);a=cc.LabelBMFont.create("Xi Ling Ran","Resources/fonts/bitmapFontTest5.fnt");a.setPosition(cc.ccp(winSize.width/2,145));this.addChild(a);a=cc.Sprite.create(s_back);a.setScale(0.5);var b=cc.Sprite.create(s_backbig);b.setScale(0.5);var c=cc.Sprite.create(s_back);c.setScale(0.5);a=cc.MenuItemSprite.create(a,b,c,this,this.backCallback);a=cc.Menu.create(a);a.setPosition(cc.ccp(winSize.width-100,150));this.addChild(a);a=!0}return a},backCallback:function(){var a=
cc.Scene.create();a.addChild(StartLayer.create());cc.Director.sharedDirector().replaceScene(cc.TransitionSlideInT.create(1.2,a))}});AboutLayer.create=function(){var a=new AboutLayer;return a&&a.init()?a:null};var GameControlMenu=cc.Layer.extend({init:function(){var a=!1;if(this._super()){var a=cc.Director.sharedDirector().getWinSize(),b=cc.Sprite.create(s_exit),c=cc.Sprite.create(s_exitbig),d=cc.Sprite.create(s_exit),b=cc.MenuItemSprite.create(b,c,d,this,this.onReturn);b.setScale(2.2);b=cc.Menu.create(b,null);b.setScale(0.2);b.setAnchorPoint(cc.ccp(0));b.setPosition(cc.ccp(a.width-38,28));this.addChild(b,global.Tag.Menu,2);a=!0}return a},onReturn:function(){Game.resume();var a=cc.Scene.create();a.addChild(MissionLayer.create());
cc.Director.sharedDirector().replaceScene(cc.TransitionMoveInB.create(1.2,a))}});GameControlMenu.create=function(){var a=new GameControlMenu;return a&&a.init()?a:null};var GameLayer=cc.Layer.extend({_time_limit:30,_cur_score:0,_dst_score:200,_roundInterval:null,_hook:null,_hook2:null,mineContainer:[],_propContainer:[],_criticalAngle:null,_round:1,winSize:null,collectAction:null,collectedObject:null,shelfMap:null,init:function(){var a=!1;if(this._super())this.winSize=cc.Director.sharedDirector().getWinSize(),this.setAnchorPoint(cc.ccp(0,0)),this.initBackground(),this.initLabels(),this.initTimeCounter(),this.initHook(),this.initShelfMap(),this.createMap(),this.createTools(),
this.setIsTouchEnabled(!0),this.schedule(this.update),global.sound&&cc.AudioManager.sharedEngine().playBackgroundMusic(s_bgMusic,!0),a=!0;return a},initBackground:function(){var a=cc.Sprite.create(s_bgdouble);a.setAnchorPoint(cc.ccp(0,0));this.addChild(a,global.zOrder.Background);var b=cc.TextureCache.sharedTextureCache().addImage(s_boy),a=cc.SpriteFrame.create(b,cc.RectMake(0,0,109,140)),c=cc.SpriteFrame.create(b,cc.RectMake(109,0,109,140)),d=cc.Sprite.createWithSpriteFrame(a);d.setPosition(new cc.ccp(this.winSize.width/
2+125,this.winSize.height-64));d.setScale(0.3);this.addChild(d,10);var e=[];e.push(c);e.push(a);e=cc.Animation.create(e,0.3);e=cc.Animate.create(e,!1);d.runAction(cc.RepeatForever.create(cc.Sequence.create(e,cc.DelayTime.create(3))));cc.TextureCache.sharedTextureCache().addImage(s_boy);cc.SpriteFrame.create(b,cc.RectMake(0,0,109,140));cc.SpriteFrame.create(b,cc.RectMake(109,0,109,140));b=cc.Sprite.createWithSpriteFrame(a);b.setPosition(new cc.ccp(this.winSize.width/2-130,this.winSize.height-64));
b.setScale(0.3);this.addChild(b,10);d=[];d.push(c);d.push(a);a=cc.Animation.create(d,0.3);a=cc.Animate.create(a,!1);b.runAction(cc.RepeatForever.create(cc.Sequence.create(a,cc.DelayTime.create(3))));a=cc.Sprite.create(s_board);a.setPosition(new cc.ccp(60,this.winSize.height-70));this.addChild(a,30);a.setScale(0.7)},initLabels:function(){this._lbDstScore=cc.LabelBMFont.create("Goal: 000",s_futura_fnt);this._lbDstScore.setScale(0.5);this.addChild(this._lbDstScore,global.zOrder.Label);this._lbDstScore.setPosition(cc.ccp(this.winSize.width-
100,this.winSize.height-30));this._lbCurScore=cc.LabelBMFont.create("Score: 000",s_futura_fnt);this._lbCurScore.setScale(0.5);this.addChild(this._lbCurScore,global.zOrder.Label);this._lbCurScore.setPosition(cc.ccp(this.winSize.width-100,this.winSize.height-60));this._lbTime=cc.LabelBMFont.create("Time: 00:00",s_futura_fnt);this._lbTime.setScale(0.5);this.addChild(this._lbTime,global.zOrder.Label);this._lbTime.setPosition(cc.ccp(this.winSize.width-100,this.winSize.height-90));this._lbRound=cc.LabelBMFont.create("Round: 0",
s_futura_fnt);this._lbRound.setScale(0.5);this._lbRound.setPosition(cc.ccp(60,this.winSize.height-100));this.addChild(this._lbRound,global.zOrder.Label)},initTimeCounter:function(){var a=this;if(0<=this._time_limit)this._roundInterval=setInterval(function(){a._time_limit--;a._lbTime.setString("Time: 00:"+a._time_limit)},1E3)},initHook:function(){this._hook=new Hook;this.addChild(this._hook,global.zOrder.Hook);this._hook.setAnchorPoint(new cc.ccp(0.5,1));this._hook.setPosition(cc.ccp(413,460));this._hook.originPosition=
cc.ccp(413,460);this._hook.scheduleUpdate();this._criticalAngle=180*(Math.atan(this.winSize.width/2/(this.winSize.height-50))/Math.PI);this._hook_path=Math.sqrt(Math.pow(this._hook.getPosition().x,2)+Math.pow(this._hook.getPosition().y,2));this._hook2=new Hook;this.addChild(this._hook2,global.zOrder.Hook);this._hook2.setAnchorPoint(new cc.ccp(0.5,1));this._hook2.setPosition(cc.ccp(380,457));this._hook2.originPosition=cc.ccp(380,457);this._hook2.scheduleUpdate()},createMap:function(){(new LevelManager(this)).createMap()},
createTools:function(){for(var a=this.shelfMap,b=0;b<Game.toolContainer.length;b++)if(null!=Game.toolContainer[b]){var c={};c.type=Game.toolContainer[b].type;c.x=a[b].x;c.y=a[b].y;var d=getObjectName(c.type),c=new ToolType[d].create(c);Game.toolContainer[b]=c;c.setScale(0.2);this.addChild(c,global.zOrder.Tool);if(c.type!=global.Tag.Bombshell)c.onUse();if(c.type==global.Tag.Scan)c.onUse()}},initShelfMap:function(){this.shelfMap=[{x:40,y:460},{x:40,y:435},{x:40,y:410},{x:85,y:460},{x:85,y:435},{x:85,
y:410}]},reOrderToolContainer:function(){(new ToolManager(this)).cleanToolContainer();for(var a=0;a<Game.toolContainer.length;a++)if(!cc.Point.CCPointEqualToPoint(Game.toolContainer[a].getPosition(),cc.ccp(this.shelfMap[a].x,this.shelfMap[a].y))){var b=cc.MoveTo.create(0.1,cc.ccp(this.shelfMap[a].x,this.shelfMap[a].y));Game.toolContainer[a].runAction(b)}},ccTouchesBegan:function(a){a=a[0].locationInView(0);if(a.x>this.winSize.width/2){if("swing"==this._hook.state&&this._hook.launch(this.getDstPoint(1)),
"retrieve"==this._hook.state)for(var a=Game.toolContainer,b=a.length-1;0<=b;b--)if(a[b].type==global.Tag.Bombshell)a[b].onUse(1)}else if(a.x<this.winSize.width/2&&("swing"==this._hook2.state&&this._hook2.launch(this.getDstPoint(2)),"retrieve"==this._hook2.state)){a=Game.toolContainer;for(b=a.length-1;0<=b;b--)if(a[b].type==global.Tag.Bombshell)a[b].onUse(2)}},draw:function(){this._super();cc.renderContext.strokeStyle="#3f3e3e";cc.drawingUtil.drawLine(this._hook.getOriginPosition(),this._hook.getPosition());
cc.drawingUtil.drawLine(this._hook2.getOriginPosition(),this._hook2.getPosition())},setCurScore:function(a){if(null!=a&&"number"==typeof a)this._cur_score=a,this._lbCurScore.setString("Score: "+this._cur_score)},setDstScore:function(a){if(null!=a&&"number"==typeof a)this._dst_score=a,this._lbDstScore.setString("Goal: "+this._dst_score)},setTimeLimit:function(a){if(null!=a&&"number"==typeof a)this._time_limit=a},setRound:function(a){if(null!=a&&"number"==typeof a)this._round=a,this._lbRound.setString("Round: "+
this._round)},updateScore:function(a){this._cur_score+=a;this._lbCurScore.setString("Score: "+this._cur_score);if(0==this.mineContainer.length)Game.round++,Game.cur_score=this._cur_score,this.onNextGame()},update:function(){this.onTimeLimit();this.checkCollision();this.checkCollision2();if(this.collectAction&&this.collectAction.isDone()&&null!=this.collectedObject)this.updateScore(this.collectedObject.getValue()),this.showMineValue(this.collectedObject),this.collectAction=this.collectedObject=null;
if(this.collectAction2&&this.collectAction2.isDone()&&null!=this.collectedObject2)this.updateScore(this.collectedObject2.getValue()),this.showMineValue(this.collectedObject2),this.collectAction2=this.collectedObject2=null},getDstPoint:function(a){var b;if(1==a)b=this._hook;else if(2==a)b=this._hook2;var a=cc.Director.sharedDirector().getWinSize(),c=b.getPosition().x,d=b.getPosition().y,e=null,f=null;if("swing"==b.state)return b.stopSwing(),b=b.getRotation(),b>this._criticalAngle?(e=10,f=d-Math.tan((90-
b)*Math.PI/180)*c):b<this._criticalAngle&&0<b?(e=c-Math.tan(b*Math.PI/180)*d,f=10):b>-this._criticalAngle&&0>b?(e=c+Math.tan(-b*Math.PI/180)*d,f=10):b<-this._criticalAngle&&(e=a.width-10,f=d-Math.tan((90+b)*Math.PI/180)*c),cc.ccp(e,f);console.error("Could not get dstPosition")},checkCollision:function(){if("launch"==this._hook.getState())for(var a=null,b=0;b<this.mineContainer.length;b++)if(null!=this.mineContainer[b]){var a=Math.pow(this._hook.getPositionX()-this.mineContainer[b].getPositionX(),
2),c=Math.pow(this._hook.getPositionY()-this.mineContainer[b].getPositionY(),2),a=Math.sqrt(a+c);if(a<this.mineContainer[b].getCollisionLength()/2)this.mineContainer[b].type==global.Tag.Pig&&this.mineContainer[b].stopAllActions(),a=Math.sqrt(Math.pow(this.mineContainer[b].getPositionX()-this._hook.getCollectPosition().x,2)+Math.pow(this.mineContainer[b].getPositionY()-this._hook.getCollectPosition().y,2)),a=2*this.mineContainer[b].weight/100*(a/this._hook_path)*Game.Speed.retrieve,this.mineContainer[b].setPosition(cc.ccp(this._hook.getPositionX(),
this._hook.getPositionY())),this.mineContainer[b].collectAction=cc.MoveTo.create(a,this._hook.getCollectPosition()),this.collectAction=this.mineContainer[b].collectAction,this.mineContainer[b].runAction(this.mineContainer[b].collectAction),this.collectedObject=this.mineContainer[b],this.popMineObject(b),this._hook.retrieve(a)}},checkCollision2:function(){if("launch"==this._hook2.getState())for(var a=null,b=0;b<this.mineContainer.length;b++)if(null!=this.mineContainer[b]){var a=Math.pow(this._hook2.getPositionX()-
this.mineContainer[b].getPositionX(),2),c=Math.pow(this._hook2.getPositionY()-this.mineContainer[b].getPositionY(),2),a=Math.sqrt(a+c);if(a<this.mineContainer[b].getCollisionLength()/2)this.mineContainer[b].type==global.Tag.Pig&&this.mineContainer[b].stopAllActions(),a=Math.sqrt(Math.pow(this.mineContainer[b].getPositionX()-this._hook2.getCollectPosition().x,2)+Math.pow(this.mineContainer[b].getPositionY()-this._hook2.getCollectPosition().y,2)),a=2*this.mineContainer[b].weight/100*(a/this._hook_path)*
Game.Speed.retrieve,this.mineContainer[b].setPosition(cc.ccp(this._hook2.getPositionX(),this._hook2.getPositionY())),this.mineContainer[b].collectAction=cc.MoveTo.create(a,this._hook2.getCollectPosition()),this.collectAction2=this.mineContainer[b].collectAction,this.mineContainer[b].runAction(this.mineContainer[b].collectAction),this.collectedObject2=this.mineContainer[b],this.popMineObject(b),this._hook2.retrieve(a)}},showMineValue:function(a){var b;if(900<=a.type&&905>=a.type)b="+"+a.getValue().toString();
else if(912<=a.type&&916>=a.type)switch(console.log(a.type),a.type){case 912:b="+10 seconds!";break;case 915:b="Hook error!";break;case 916:b="Scanning"}var c=cc.LabelBMFont.create(b,s_futura_fnt);c.setPosition(cc.ccp(winSize.width/2,winSize.height-100));this.addChild(c,50);setTimeout(function(){c.setIsVisible(!1)},1E3)},popMineObject:function(a){for(var b=[],c=0,d=0;d<this.mineContainer.length;d++)d!=a&&(b[c++]=this.mineContainer[d]);this.mineContainer=b},onTimeLimit:function(){if(0>=this._time_limit&&
this._cur_score<this._dst_score)this.onGameOver();else if(0>=this._time_limit&&this._cur_score>=this._dst_score)Game.round++,Game.cur_score=this._cur_score,this.onNextGame()},onGameOver:function(){saveRecord(this._cur_score);Game.resume();var a=cc.Scene.create();a.addChild(GameOverLayer.create());a.addChild(GameControlMenu.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a));this.getParent().removeChild(this)},onNextGame:function(){Game.cleanToolObjects();var a=cc.Scene.create();
a.addChild(StoreLayer.create());a.addChild(GameControlMenu.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a));this.getParent().removeChild(this)},onReturn:function(){var a=cc.Scene.create();a.addChild(StartLayer.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a));this.getParent().removeChild(this)}});GameLayer.create=function(){var a=new GameLayer;return a&&a.init()?a:null};
GameLayer.scene=function(){var a=cc.Scene.create(),b=GameLayer.create();a.addChild(b,1);return a};var GameOverLayer=cc.Layer.extend({init:function(){var a=!1;if(this._super){a=cc.Sprite.create(global.theme.info_bg);a.setAnchorPoint(cc.PointZero());this.addChild(a,0,1);cc.Director.sharedDirector().getWinSize();var a=cc.Sprite.create(s_replay),b=cc.Sprite.create(s_replaybig),c=cc.Sprite.create(s_replay),a=cc.MenuItemSprite.create(a,b,c,this,this.onPlayAgain);this.addChild(cc.Menu.create(a));a=!0}return a},onPlayAgain:function(){var a=cc.Scene.create();a.addChild(MissionLayer.create());a.addChild(GameControlMenu.create());
cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a))}});GameOverLayer.create=function(){var a=new GameOverLayer;return a&&a.init()?a:null};GameOverLayer.scene=function(){var a=cc.Scene.create(),b=GameOverLayer.create();a.addChild(b);return a};var LevelManager=cc.Class.extend({_currentRound:null,_currentMission:null,_gameLayer:null,addQ:300,ctor:function(a){if(!a)throw"gameLayer must be non-nil";this._currentRound=Game.round;this._currentMission=Game.mission;this._gameLayer=a},_minuteToSecond:function(a){if(!a)return 0;return"number"!=typeof a?(a=a.split(":"),1==a.length?parseInt(a[0]):60*parseInt(a[0])+parseInt(a[1])):a},updateGameStatus:function(){Game.dst_score=this.getDstScore(Game.round);this._gameLayer.setDstScore(Game.dst_score);
this._gameLayer.setCurScore(Game.cur_score);this._gameLayer.setRound(Game.round)},getDstScore:function(a){var b=Game.dst_score;1>=a?b=600:5>=a&&1<a?b+=500:5<a&&10>a?(this.addQ=300*(a-4),b+=this.addQ):10<=a&&(b+=2700);return b},createMap:function(){if(3<=Game.difficulty)Game.difficulty=3;var a=Game.difficulty-1;console.log(Game.difficulty);this._gameLayer.mineContainer=[];var b=(this._currentRound-1)%NUMBER_OF_ROUNDS;this.updateGameStatus();for(var c=0;c<Round[a][b].length;c++){var d=Math.round(Math.random()),
e=getObjectName(Round[a][b][c].type),e=new MineType[e].create(Round[a][b][c],d);null!=e&&(this._gameLayer.addChild(e,e.zOrder,e.type),this._gameLayer.mineContainer.push(e))}this._gameLayer.propContainer=[];a={};a.x=Math.random()*winSize.width;if(0>=a.x)ojbect.x=40;else if(a.x>=winSize.width)a.x=winSize.width-20;a.y=Math.random()*winSize.height-170;if(0>=a.y)a.y=40;else if(a.y>=winSize.height-70)ojbect.y=40;e=Mission[0].props[b%3];a.type=global.Tag[e];b=new PropType[e].create(a);this._gameLayer.addChild(b,
global.zOrder.Prop);this._gameLayer.mineContainer.push(b)}});var MissionLayer=cc.Layer.extend({_missionView:null,_curPos:500,_beginPos:null,_missionWidth:200,_isMouseDown:!1,_missions:3,_begin:null,_num:1,_direction:0,init:function(){var a=!1;if(this._super){cc.Director.sharedDirector().getWinSize();a=cc.Sprite.create(s_mission_bg);a.setAnchorPoint(cc.PointZero());this.addChild(a,0,1);var a=cc.Director.sharedDirector().getWinSize(),b=cc.Sprite.create(s_exit),c=cc.Sprite.create(s_exitbig),d=cc.Sprite.create(s_exit),b=cc.MenuItemSprite.create(b,c,d,this,this.onReturn);
b.setScale(2.2);b=cc.Menu.create(b,null);b.setScale(0.2);b.setAnchorPoint(cc.ccp(0));b.setPosition(cc.ccp(a.width-38,28));this.addChild(b,global.Tag.Menu,2);this._missions=3;this.initMissionView();a=!0;this.setIsTouchEnabled(!0)}return a},initMissionView:function(){this._missionView=new cc.Layer;this._missionView.setAnchorPoint(cc.ccp(0,0));for(var a=this._missions,b=0;b<Mission.length;b++){var c=cc.Sprite.create(Mission[b].image);b>a-1&&c.setOpacity(0.8);this._missionView.addChild(c);c.setPosition(cc.ccp(b*
(this._missionWidth+10),0));c.setScale(0.7)}this.addChild(this._missionView,2,2);this._missionView.setContentSize(cc.SizeMake(b*(this._missionWidth+10),100));this._begin=winSize.width/2;this._missionView.setPosition(cc.ccp(this._begin,winSize.height/2));a=cc.Sprite.create(s_mission1);a.setPosition(cc.ccp(winSize.width/2,winSize.height/2));this.addChild(a,1);a=cc.Sprite.create(s_mission_ruler);a.setPosition(cc.ccp(winSize.width/2,winSize.height/2+100));this.addChild(a,10);a.setScale(0.9);a.setScaleY(0.8);
var d=cc.Sprite.create(s_singleplayer),e=cc.Sprite.create(s_singleplayer),f=cc.Sprite.create(s_singleplayerbig),a=cc.ScaleBy.create(0.5,1.02,1.02),b=cc.Sprite.create(s_doubleplayer),c=cc.Sprite.create(s_doubleplayer),g=cc.Sprite.create(s_doubleplayerbig),d=cc.MenuItemSprite.create(d,f,e,this,this.onMissionSelected);d.setPosition(cc.ccp(winSize.width/2-120,100));b=cc.MenuItemSprite.create(c,g,b,this,this.onMissionSelected2);b.setPosition(cc.ccp(winSize.width/2+120,100));b=cc.Menu.create(d,b);b.setPosition(cc.ccp(0,
0));b.runAction(cc.RepeatForever.create(cc.Sequence.create(a,a.reverse(),null)));this.addChild(b,1,2)},ccTouchesBegan:function(a){if(!this.isMouseDown)this._beginPos=a[0].locationInView(0).x;this.isMouseDown=!0},ccTouchesMoved:function(a){if(this.isMouseDown){var b=a[0].locationInView(0).x,c=b-this._beginPos;this._curPos=this._missionView.getPosition();c=cc.ccp(this._curPos.x+c,this._curPos.y);this._missionView.setPosition(c);this._beginPos=b;this._curPos=c;this._direction=a[0].locationInView(0).x-
a[0].previousLocationInView(0).x}},ccTouchesEnded:function(){Game._num=0>this._direction?Math.ceil(Math.abs(this._curPos.x-this._begin)/(this._missionWidth+10))+1:Math.ceil(Math.abs(this._curPos.x-this._begin)/(this._missionWidth+10));if(3<Game._num)this._num=3;"undefined"==typeof this._direction?(Game._num=Math.ceil(Math.abs(this._curPos.x-this._begin)/(this._missionWidth+10)),this.isMouseDown=!1):(this.moveToMission(Game._num),this.isMouseDown=!1,Game.difficulty=Game._num||Game.difficulty,Game.Speed.rotate=
1==Game.difficulty?2:2==Game.difficulty?1:0.8)},moveToMission:function(a){a>NUMBER_OF_MISSIONS&&(a=NUMBER_OF_MISSIONS);this._missionView.runAction(cc.MoveTo.create(0.1,cc.ccp(this._begin-(a-1)*(this._missionWidth+10),winSize.height/2)))},onMissionSelected:function(){Game.gameMode=1;Game.resume();Game.mission=Game._num;var a=cc.Scene.create();a.addChild(singleGameLayer.create());a.addChild(GameControlMenu.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a))},onMissionSelected2:function(){Game.gameMode=
2;Game.resume();Game.mission=Game._num;var a=cc.Scene.create();a.addChild(GameLayer.create());a.addChild(GameControlMenu.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a))},showIndication:function(){console.log("Indication")},onReturn:function(){var a=cc.Scene.create();a.addChild(StartLayer.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(0.7,a))}});MissionLayer.create=function(){var a=new MissionLayer;return a&&a.init()?a:null};
MissionLayer.scene=function(){var a=cc.Scene.create(),b=MissionLayer.create();a.addChild(b);return a};var RecordLayer=cc.Layer.extend({init:function(){var a=!1;if(this._super()){a=cc.Sprite.create(s_background2);a.setAnchorPoint(cc.PointZero());this.addChild(a,0,1);this.initRecord();a=cc.Sprite.create(s_back);a.setScale(0.5);var b=cc.Sprite.create(s_backbig);b.setScale(0.5);var c=cc.Sprite.create(s_back);c.setScale(0.5);a=cc.MenuItemSprite.create(a,b,c,this,this.onReturn);a=cc.Menu.create(a);a.setPosition(cc.ccp(winSize.width-100,150));this.addChild(a);a=!0}return a},initRecord:function(){var a=getRecords(),
b=325,c=["First","Second","Third","Yours"];if(null!=a&&0!=a.length)for(var d=0;d<a.length;d++){var e=cc.LabelBMFont.create(c[d]+" : "+a[d],"Resources/fonts/bitmapFontTest3.fnt");e.setPosition(cc.ccp(winSize.width/2,b));b-=60;this.addChild(e)}},onAccept:function(){var a=cc.Scene.create();a.addChild(GameLayer.create());cc.Director.sharedDirector().replaceScene(cc.TransitionSlideInT.create(1.2,a));this.getParent().removeChild(this)},onReturn:function(){var a=cc.Scene.create();a.addChild(StartLayer.create());
cc.Director.sharedDirector().replaceScene(cc.TransitionSlideInT.create(1.2,a))}});RecordLayer.create=function(){var a=new RecordLayer;return a&&a.init()?a:null};RecordLayer.scene=function(){var a=cc.Scene.create(),b=RecordLayer.create();a.addChild(b,1);return a};
var saveRecord=function(a){if("undefined"!==typeof Storage){var b=localStorage.record,b=b.split(",");b.push(""+a);localStorage.yourScore=a;b.sort();b.reverse();localStorage.record=b}else console.error("Sorry! No web storage support..")},getRecords=function(){var a=[];if("undefined"!==typeof Storage)return a=localStorage.record.split(",").slice(0,3),a.push(localStorage.yourScore),a;console.error("Sorry! No web storage support..")};var SettingsLayer=cc.Layer.extend({init:function(){var a=!1;if(this._super()){a=cc.Sprite.create(s_background2);a.setAnchorPoint(cc.PointZero());this.addChild(a,0,1);a=cc.TextureCache.sharedTextureCache().addImage(s_menuTitle);a=cc.Sprite.createWithTexture(a,cc.RectMake(0,0,134,34));a.setPosition(cc.ccp(winSize.width/2,winSize.height-120));this.addChild(a);cc.MenuItemFont.setFontName("Arial");cc.MenuItemFont.setFontSize(18);var b=cc.MenuItemFont.create("Sound");b.setIsEnabled(!1);cc.MenuItemFont.setFontName("Arial");
cc.MenuItemFont.setFontSize(26);var c=cc.MenuItemToggle.create(this,this.soundControl,cc.MenuItemFont.create("On"),cc.MenuItemFont.create("Off"));cc.MenuItemFont.setFontName("Arial");cc.MenuItemFont.setFontSize(18);var d=cc.MenuItemFont.create("Mode");d.setIsEnabled(!1);cc.MenuItemFont.setFontName("Arial");cc.MenuItemFont.setFontSize(26);var e=cc.MenuItemToggle.create(this,this.modeControl,cc.MenuItemFont.create("Easy"),cc.MenuItemFont.create("Normal"),cc.MenuItemFont.create("Hard"));cc.MenuItemFont.setFontName("Arial");
cc.MenuItemFont.setFontSize(26);a=cc.LabelTTF.create("Go back","Arial",20);a=cc.MenuItemLabel.create(a,this,this.backCallback);a.setScale(0.8);b=cc.Menu.create(b,d,c,e,a);b.alignItemsInColumns(2,2,1);this.addChild(b);b=a.getPosition();b.y-=50;a.setPosition(b);a=!0}return a},backCallback:function(){var a=cc.Scene.create();a.addChild(StartLayer.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a))},soundControl:function(){global.sound=global.sound?!1:!0;global.sound||
cc.AudioManager.sharedEngine().end()},modeControl:function(){}});SettingsLayer.create=function(){var a=new SettingsLayer;return a&&a.init()?a:null};var singleGameLayer=cc.Layer.extend({_time_limit:60,_cur_score:0,_dst_score:200,_roundInterval:null,_hook:null,mineContainer:[],_propContainer:[],_criticalAngle:null,_round:1,winSize:null,collectAction:null,collectedObject:null,shelfMap:null,init:function(){var a=!1;if(this._super())this.winSize=cc.Director.sharedDirector().getWinSize(),this.setAnchorPoint(cc.ccp(0,0)),this.initBackground(),this.initLabels(),this.initTimeCounter(),this.initHook(),this.initShelfMap(),this.createMap(),this.setIsTouchEnabled(!0),
this.setIsKeypadEnabled(!0),this.schedule(this.update),global.sound&&cc.AudioManager.sharedEngine().playBackgroundMusic(s_bgMusic,!0),a=!0;return a},initBackground:function(){var a=cc.Sprite.create(s_gamebg);a.setAnchorPoint(cc.ccp(0,0));this.addChild(a,global.zOrder.Background);var a=cc.TextureCache.sharedTextureCache().addImage(s_boy),b=cc.SpriteFrame.create(a,cc.RectMake(0,0,109,140)),c=cc.SpriteFrame.create(a,cc.RectMake(109,0,109,140)),a=cc.Sprite.createWithSpriteFrame(b);a.setPosition(new cc.ccp(this.winSize.width/
2+115,this.winSize.height-58));a.setScale(0.3);this.addChild(a,1);var d=[];d.push(c);d.push(b);b=cc.Animation.create(d,0.3);b=cc.Animate.create(b,!1);a.runAction(cc.RepeatForever.create(cc.Sequence.create(b,cc.DelayTime.create(3))));a=cc.Sprite.create(s_board);a.setPosition(new cc.ccp(60,this.winSize.height-70));this.addChild(a,30);a.setScale(0.7)},initLabels:function(){this._lbDstScore=cc.LabelBMFont.create("Goal: 000",s_futura_fnt);this._lbDstScore.setScale(0.5);this.addChild(this._lbDstScore,global.zOrder.Label);
this._lbDstScore.setPosition(cc.ccp(this.winSize.width-100,this.winSize.height-30));this._lbCurScore=cc.LabelBMFont.create("Score: 000",s_futura_fnt);this._lbCurScore.setScale(0.5);this.addChild(this._lbCurScore,global.zOrder.Label);this._lbCurScore.setPosition(cc.ccp(this.winSize.width-100,this.winSize.height-60));this._lbTime=cc.LabelBMFont.create("Time: 00:00",s_futura_fnt);this._lbTime.setScale(0.5);this.addChild(this._lbTime,global.zOrder.Label);this._lbTime.setPosition(cc.ccp(this.winSize.width-
100,this.winSize.height-90));this._lbRound=cc.LabelBMFont.create("Round: 0",s_futura_fnt);this._lbRound.setScale(0.5);this._lbRound.setPosition(cc.ccp(60,this.winSize.height-100));this.addChild(this._lbRound,global.zOrder.Label)},initTimeCounter:function(){var a=this;this._roundInterval=setInterval(function(){a._time_limit--;a._lbTime.setString("Time: 00:"+a._time_limit)},1E3)},initHook:function(){this._hook=new Hook;this.addChild(this._hook,global.zOrder.Hook);this._hook.setAnchorPoint(new cc.ccp(0.5,
1));this._hook.setPosition(cc.ccp(403,462));this._hook.originPosition=cc.ccp(403,462);this._hook.scheduleUpdate();this._criticalAngle=180*(Math.atan(this.winSize.width/2/(this.winSize.height-50))/Math.PI);this._hook_path=Math.sqrt(Math.pow(this._hook.getPosition().x,2)+Math.pow(this._hook.getPosition().y,2))},createMap:function(){(new LevelManager(this)).createMap();(new ToolManager(this)).getTools()},initShelfMap:function(){this.shelfMap=[{x:40,y:460},{x:40,y:435},{x:40,y:410},{x:85,y:460},{x:85,
y:435},{x:85,y:410}]},reOrderToolContainer:function(){(new ToolManager(this)).cleanToolContainer();for(var a=0;a<Game.toolContainer.length;a++)if(!cc.Point.CCPointEqualToPoint(Game.toolContainer[a].getPosition(),cc.ccp(this.shelfMap[a].x,this.shelfMap[a].y))){var b=cc.MoveTo.create(0.1,cc.ccp(this.shelfMap[a].x,this.shelfMap[a].y));Game.toolContainer[a].runAction(b)}},ccTouchesBegan:function(){"swing"==this._hook.state&&this._hook.launch(this.getDstPoint());if("retrieve"==this._hook.state)for(var a=
Game.toolContainer,b=a.length-1;0<=b;b--)if(a[b].type==global.Tag.Bombshell)a[b].onUse()},draw:function(){this._super();cc.renderContext.strokeStyle="#3f3e3e";cc.drawingUtil.drawLine(this._hook.getOriginPosition(),this._hook.getPosition())},setCurScore:function(a){if(null!=a&&"number"==typeof a)this._cur_score=a,this._lbCurScore.setString("Score: "+this._cur_score)},setDstScore:function(a){if(null!=a&&"number"==typeof a)this._dst_score=a,this._lbDstScore.setString("Goal: "+this._dst_score)},setTimeLimit:function(a){if(null!=
a&&"number"==typeof a)this._time_limit=a},setRound:function(a){if(null!=a&&"number"==typeof a)this._round=a,this._lbRound.setString("Round: "+this._round)},updateScore:function(a){this._cur_score+=a;this._lbCurScore.setString("Score: "+this._cur_score);if(0==this.mineContainer.length)Game.round++,Game.cur_score=this._cur_score,this.onNextGame()},update:function(){this.onTimeLimit();this.checkCollision();if(this.collectAction&&this.collectAction.isDone()&&null!=this.collectedObject)this.updateScore(this.collectedObject.getValue()),
this.showMineValue(this.collectedObject),this.collectAction=this.collectedObject=null},getDstPoint:function(){var a=cc.Director.sharedDirector().getWinSize(),b=this._hook.getPosition().x,c=this._hook.getPosition().y,d=null,e=null;if("swing"==this._hook.state){this._hook.stopSwing();var f=this._hook.getRotation();f>this._criticalAngle?(d=10,e=c-Math.tan((90-f)*Math.PI/180)*b):f<this._criticalAngle&&0<f?(d=b-Math.tan(f*Math.PI/180)*c,e=10):f>-this._criticalAngle&&0>f?(d=b+Math.tan(-f*Math.PI/180)*c,
e=10):f<-this._criticalAngle&&(d=a.width-10,e=c-Math.tan((90+f)*Math.PI/180)*b);return cc.ccp(d,e)}console.error("Could not get dstPosition")},checkCollision:function(){if("launch"==this._hook.getState())for(var a=null,b=0;b<this.mineContainer.length;b++)if(null!=this.mineContainer[b]){var a=Math.pow(this._hook.getPositionX()-this.mineContainer[b].getPositionX(),2),c=Math.pow(this._hook.getPositionY()-this.mineContainer[b].getPositionY(),2),a=Math.sqrt(a+c);if(a<this.mineContainer[b].getCollisionLength()/
2)this.mineContainer[b].type==global.Tag.Pig&&this.mineContainer[b].stopAllActions(),a=Math.sqrt(Math.pow(this.mineContainer[b].getPositionX()-this._hook.getCollectPosition().x,2)+Math.pow(this.mineContainer[b].getPositionY()-this._hook.getCollectPosition().y,2)),a=2*this.mineContainer[b].weight/100*(a/this._hook_path)*Game.Speed.retrieve,this.mineContainer[b].setPosition(cc.ccp(this._hook.getPositionX(),this._hook.getPositionY())),this.mineContainer[b].collectAction=cc.MoveTo.create(a,this._hook.getCollectPosition()),
this.collectAction=this.mineContainer[b].collectAction,this.mineContainer[b].runAction(cc.Sequence.create(this.mineContainer[b].collectAction)),this.collectedObject=this.mineContainer[b],this.popMineObject(b),this._hook.retrieve(a)}},showMineValue:function(a){var b;if(900<=a.type&&905>=a.type)b="+"+a.getValue().toString();else if(912<=a.type&&916>=a.type)switch(console.log(a.type),a.type){case 912:b="+10 seconds!";break;case 915:b="Hook error!";break;case 916:b="Scanning"}var c=cc.LabelBMFont.create(b,
s_futura_fnt);c.setPosition(cc.ccp(winSize.width/2,winSize.height-100));this.addChild(c,50);setTimeout(function(){c.setIsVisible(!1)},1E3)},popMineObject:function(a){for(var b=[],c=0,d=0;d<this.mineContainer.length;d++)d!=a&&(b[c++]=this.mineContainer[d]);this.mineContainer=b},onTimeLimit:function(){if(0>=this._time_limit&&this._cur_score<this._dst_score)this.onGameOver();else if(0>=this._time_limit&&this._cur_score>=this._dst_score)Game.round++,Game.cur_score=this._cur_score,this.onNextGame()},onGameOver:function(){Game.resume();
saveRecord(this._cur_score);var a=cc.Scene.create();a.addChild(GameOverLayer.create());a.addChild(GameControlMenu.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a));this.getParent().removeChild(this)},onNextGame:function(){Game.cleanToolObjects();var a=cc.Scene.create();a.addChild(StoreLayer.create());a.addChild(GameControlMenu.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a));this.getParent().removeChild(this)},onReturn:function(){var a=
cc.Scene.create();a.addChild(StartLayer.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a));this.getParent().removeChild(this)}});singleGameLayer.create=function(){var a=new singleGameLayer;return a&&a.init()?a:null};singleGameLayer.scene=function(){var a=cc.Scene.create(),b=singleGameLayer.create();a.addChild(b,1);return a};var SplashLayer=cc.Layer.extend({_background:null,init:function(){this._background=cc.Sprite.create(s_splash_background);this._background.setAnchorPoint(cc.PointZero());this.addChild(this.background,-10);gotoStartLayer()},gotoStartLayer:function(){var a=cc.Scene.create();a.addChild(StartLayer.create());cc.Director.sharedDirctor().replaceScene(cc.TransitionFade.create(1.2,a));this.getParent().removeChild(this)}});SplashLayer.create=function(){var a=new SplashLayer;return a&&a.init()?a:null};
SplashLayer.scene=function(){var a=cc.Scene.create(),b=SplashLayer.create();a.addChild(b,1);return a};var StartLayer=cc.Layer.extend({_ship:null,init:function(){var a=!1;this._super&&(winSize=cc.Director.sharedDirector().getWinSize(),this.initLogo(),this.initBackground(),this.initMenu(),this.initSprites(),global.sound&&(cc.AudioManager.sharedEngine().setBackgroundMusicVolume(0.7),cc.AudioManager.sharedEngine().playBackgroundMusic(s_mainMainMusic,!0)),a=!0);return a},initLogo:function(){},initBackground:function(){var a=cc.Sprite.create(s_bg);a.setAnchorPoint(cc.PointZero());this.addChild(a,0,1)},
initMenu:function(){var a=cc.Sprite.create(s_array1),b=cc.Sprite.create(s_array2),c=cc.Sprite.create(s_array3),d=cc.Sprite.create(s_array1),e=cc.Sprite.create(s_array2),f=cc.Sprite.create(s_array3),g=cc.Sprite.create(s_array1_big),h=cc.Sprite.create(s_array2_big),i=cc.Sprite.create(s_array3_big),a=cc.MenuItemSprite.create(a,g,d,this,function(){this.onButtonEffect();flareEffect(this,this,this.onNewGame)});a.setPosition(cc.ccp(0,50));c=cc.MenuItemSprite.create(c,i,f,this,this.onRecord);c.setPosition(cc.ccp(150,
120));b=cc.MenuItemSprite.create(b,h,e,this,this.onAbout);b.setPosition(cc.ccp(280,180));b=cc.Menu.create(c,a,b);b.setPosition(cc.ccp(winSize.width/2,winSize.height/2));e=cc.JumpBy.create(1,cc.PointMake(0,0),7,1);b.runAction(cc.RepeatForever.create(e));this.addChild(b,1,2)},initSprites:function(){var a=cc.TextureCache.sharedTextureCache().addImage(s_animals),b=cc.SpriteFrame.create(a,cc.RectMake(0,0,90,130)),c=cc.Sprite.createWithSpriteFrame(b);c.setPosition(cc.ccp(250,430));c.setScale(0.9);this.addChild(c,
10);var d=cc.SpriteFrame.create(a,cc.RectMake(103,0,90,130)),e=cc.SpriteFrame.create(a,cc.RectMake(1,136,85,130)),a=cc.SpriteFrame.create(a,cc.RectMake(103,136,90,130)),f=[];f.push(b);f.push(d);f.push(e);f.push(a);a=cc.Animation.create(f,0.5);a=cc.Animate.create(a,!1);c.runAction(cc.RepeatForever.create(a));b=cc.TextureCache.sharedTextureCache().addImage(s_dog);a=cc.SpriteFrame.create(b,cc.RectMake(0,0,237,159));c=cc.Sprite.createWithSpriteFrame(a);c.setPosition(cc.ccp(400,420));c.setScale(0.5);this.addChild(c,
10);b=cc.SpriteFrame.create(b,cc.RectMake(0,159,237,159));d=[];d.push(a);d.push(b);a=cc.Animation.create(d,0.5);a=cc.Animate.create(a,!1);c.runAction(cc.RepeatForever.create(a));d=cc.TextureCache.sharedTextureCache().addImage(s_cow);a=cc.SpriteFrame.create(d,cc.RectMake(0,0,324,200));c=cc.Sprite.createWithSpriteFrame(a);c.setPosition(cc.ccp(120,100));c.setScale(0.7);this.addChild(c,10);b=cc.SpriteFrame.create(d,cc.RectMake(0,200,324,200));d=cc.SpriteFrame.create(d,cc.RectMake(0,400,324,200));e=[];
e.push(a);e.push(b);e.push(d);a=cc.Animation.create(e,0.5);a=cc.Animate.create(a,!1);c.runAction(cc.RepeatForever.create(a));c=cc.JumpBy.create(2,cc.PointMake(0,0),14,1);a=cc.Sprite.create(s_small_diamond);a.setPosition(cc.ccp(60,310));a.runAction(cc.RepeatForever.create(c));this.addChild(a,40);a=cc.TextureCache.sharedTextureCache().addImage(s_sheep);b=cc.SpriteFrame.create(a,cc.RectMake(0,0,110,170));d=cc.SpriteFrame.create(a,cc.RectMake(117,0,130,170));e=cc.SpriteFrame.create(a,cc.RectMake(251,
0,130,170));cc.SpriteFrame.create(a,cc.RectMake(387,0,130,170));c=cc.Sprite.createWithSpriteFrame(b);c.setPosition(cc.ccp(350,100));c.setScale(1);this.addChild(c,10);a=[];a.push(b);a.push(d);a.push(e);a=cc.Animation.create(a,0.5);a=cc.Animate.create(a,!1);c.runAction(cc.RepeatForever.create(a));c=cc.JumpBy.create(2,cc.PointMake(0,0),14,1);a=cc.Sprite.create(s_small_gold);a.setPosition(cc.ccp(580,110));this.addChild(a,40);a.runAction(cc.RepeatForever.create(c))},onNewGame:function(){var a=cc.Scene.create();
a.addChild(MissionLayer.create());cc.Director.sharedDirector().replaceScene(cc.TransitionSlideInL.create(1.2,a))},onSettings:function(){this.onButtonEffect();var a=cc.Scene.create();a.addChild(SettingsLayer.create());a.addChild(GameControlMenu.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a))},onRecord:function(){this.onButtonEffect();var a=cc.Scene.create();a.addChild(RecordLayer.create());cc.Director.sharedDirector().replaceScene(cc.TransitionSlideInB.create(1.2,
a))},onAbout:function(){this.onButtonEffect();var a=cc.Scene.create();a.addChild(AboutLayer.create());cc.Director.sharedDirector().replaceScene(cc.TransitionSlideInB.create(1.2,a))},onButtonEffect:function(){global.sound&&cc.AudioManager.sharedEngine().playEffect(s_buttonEffect)}});StartLayer.create=function(){var a=new StartLayer;return a&&a.init()?a:null};StartLayer.scene=function(){var a=cc.Scene.create(),b=StartLayer.create();a.addChild(b);return a};var StoreLayer=cc.Layer.extend({shelfMap:null,describeLabel:null,isMouseDown:!1,init:function(){var a=!1;if(this._super()){a=cc.Sprite.create(s_shopbg);a.setAnchorPoint(cc.PointZero());this.addChild(a,0,1);this._lbCurScore=cc.LabelBMFont.create("Score: "+Game.cur_score,"Resources/fonts/bitmapFontTest5.fnt");this.addChild(this._lbCurScore,global.zOrder.Label);this._lbCurScore.setPosition(cc.ccp(155,180));var a=cc.Sprite.create(s_nextgame),b=cc.Sprite.create(s_nextgamebig),c=cc.Sprite.create(s_nextgame),
a=cc.MenuItemSprite.create(a,b,c,this,this.onAccept),a=cc.Menu.create(a);this.addChild(a,1,2);a.setPosition(cc.ccp(550,150));this.describeLabel=cc.LabelTTF.create(" ",cc.SizeMake(400,200),cc.TEXT_ALIGNMENT_LEFT,"Arial",25);this.describeLabel.setPosition(cc.ccp(130,120));this.describeLabel.setColor(new cc.Color3B(0,0,0));this.describeLabel.setAnchorPoint(cc.PointZero());this.addChild(this.describeLabel,20);this.initShelfMap();this.createTools();this.scheduleUpdate();this.setIsTouchEnabled(!0);a=!0}return a},
initShelfMap:function(){this.shelfMap=[{x:470,y:290},{x:570,y:290},{x:670,y:290},{x:470,y:350},{x:570,y:350},{x:670,y:350},{x:130,y:290},{x:230,y:290},{x:330,y:290},{x:130,y:350},{x:230,y:350},{x:330,y:350}]},createTools:function(){Game.toolContainer=[];for(var a=(Game.round-1)%NUMBER_OF_ROUNDS,b=this.shelfMap,c="Milk1,Milk2,Longer,Bombshell,BoneToGold,RockToRich".split(","),d=0,a=6,e=0;e<a;e++){var f=c[e],g=cc.Sprite.create(ToolType[f].image);g.setScale(0.5);g.type=global.Tag[f];g.value=ToolType[f].value;
g.originPosition=cc.ccp(b[d].x,b[d].y);g.setPosition(cc.ccp(b[d].x,b[d].y));this.addChild(g,global.zOrder.Tool);d++}},ccTouchesBegan:function(){},ccTouchesMoved:function(){},ccTouchesEnded:function(a){this.isMouseDown=!1;for(var b=a[0].locationInView(0).x,c=a[0].locationInView(0).y,a=cc.ccp(0,0),d=0;d<this.shelfMap.length;d++)if(20>Math.sqrt(Math.pow(b-this.shelfMap[d].x,2)+Math.pow(c-this.shelfMap[d].y,2))){a=cc.ccp(this.shelfMap[d].x,this.shelfMap[d].y);break}b=this.getChildren();for(c=0;c<b.length;c++)if(cc.Point.CCPointEqualToPoint(b[c].getPosition(),
a))if(this.touchedObject=b[c],0<=d&&5>=d)this.onBuy();else if(6<=d&&11>=d)this.onUnBuy()},onBuy:function(){if(this.touchedObject.value<=Game.cur_score){if(this.touchedObject.type===global.Tag.Milk2)for(var a=0,b=Game.toolContainer.length;a<b;a++)if(Game.toolContainer[a].type===global.Tag.Milk1){var c=this.touchedObject;this.touchedObject=Game.toolContainer[a];this.onUnBuy();this.touchedObject=c}if(this.touchedObject.type===global.Tag.Milk1)for(a=0,b=Game.toolContainer.length;a<b;a++)if(Game.toolContainer[a].type===
global.Tag.Milk2)c=this.touchedObject,this.touchedObject=Game.toolContainer[a],this.onUnBuy(),this.touchedObject=c;Game.cur_score-=this.touchedObject.value;Game.toolContainer.push(this.touchedObject);this.touchedObject.runAction(cc.MoveTo.create(0.2,this.shelfMap[5+Game.toolContainer.length]))}},onUnBuy:function(){Game.cur_score+=this.touchedObject.value;Game.popToolObject(this.touchedObject.type);this.touchedObject.runAction(cc.MoveTo.create(0.2,this.touchedObject.originPosition));this.reOrderBuyedTools()},
reOrderBuyedTools:function(){for(var a=0;a<Game.toolContainer.length;a++)if(!cc.Point.CCPointEqualToPoint(Game.toolContainer[a].getPosition(),cc.ccp(this.shelfMap[6+a].x,this.shelfMap[6+a].y))){var b=cc.MoveTo.create(0.2,cc.ccp(this.shelfMap[6+a].x,this.shelfMap[6+a].y));Game.toolContainer[a].runAction(b)}},showIndication:function(){var a="\u94a9\u5b50\u56de\u6536\u901f\u5ea6x2 $500,\u94a9\u5b50\u56de\u6536\u901f\u5ea6x4 $2000,\u94a9\u5b50\u53d8\u957f\u66f4\u6613\u7784\u51c6 $500,\u70b8\u6389\u4e0d\u9700\u8981\u7684\u7269\u54c1 $800,\u6240\u6709\u9aa8\u5934\u53d8\u4e3a\u91d1\u5b50 $600,\u6240\u6709\u77f3\u5934\u4ef7\u683c\u589e\u52a0 $200".split(",");
null!=this.touchedObject&&(a=a[this.touchedObject.type-global.Tag.Milk1])&&this.describeLabel.setString(a)},update:function(){this._lbCurScore.setString("Score: "+Game.cur_score);this.showIndication()},onAccept:function(){if(1==Game.gameMode){var a=cc.Scene.create();a.addChild(singleGameLayer.create());a.addChild(GameControlMenu.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a));this.getParent().removeChild(this)}else 2==Game.gameMode&&(a=cc.Scene.create(),a.addChild(GameLayer.create()),
a.addChild(GameControlMenu.create()),cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a)),this.getParent().removeChild(this))},onReturn:function(){var a=cc.Scene.create();a.addChild(StartLayer.create());cc.Director.sharedDirector().replaceScene(cc.TransitionFade.create(1.2,a));this.getParent().removeChild(this)}});StoreLayer.create=function(){var a=new StoreLayer;return a&&a.init()?a:null};
StoreLayer.scene=function(){var a=cc.Scene.create(),b=StoreLayer.create();a.addChild(b,1);return a};var ToolManager=cc.Class.extend({_currentRound:null,_layer:null,ctor:function(a){if(!a)throw"storeLayer must be non-nil";this._currentRound=Game.round;this._layer=a},createTools:function(){Game.toolContainer=[];for(var a=(this._currentRound-1)%NUMBER_OF_ROUNDS,b=this._layer.shelfMap,c="Milk1,Milk2,Longer,Bombshell,BoneToGold,RockToRich".split(","),d=0,a=6,e=0;e<a;e++){var f={};f.type=global.Tag[c[e]];f.x=b[d].x;f.y=b[d].y;f=new ToolObject(f);f.setScale(0.5);this._layer.addChild(f,global.zOrder.Tool);
d++}},getTools:function(){var a=this._layer.shelfMap;this.cleanToolContainer();for(var b=0;b<Game.toolContainer.length;b++)if(null!=Game.toolContainer[b]){var c={};c.type=Game.toolContainer[b].type;c.x=a[b].x;c.y=a[b].y;var d=getObjectName(c.type),c=new ToolType[d].create(c);Game.toolContainer[b]=c;c.setScale(0.2);this._layer.addChild(c,global.zOrder.Tool);if(c.type!=global.Tag.Bombshell)c.onUse()}},cleanToolContainer:function(){for(var a=[],b=0,c=0;c<Game.toolContainer.length;c++)null!=Game.toolContainer[c]&&
(a[b++]=Game.toolContainer[c]);Game.toolContainer=a}});
